"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/stripe/webhook";
exports.ids = ["pages/api/stripe/webhook"];
exports.modules = {

/***/ "(api-node)/./lib/stripe.ts":
/*!***********************!*\
  !*** ./lib/stripe.ts ***!
  \***********************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PLAN_DETAILS: () => (/* binding */ PLAN_DETAILS),\n/* harmony export */   STRIPE_PRICE_IDS: () => (/* binding */ STRIPE_PRICE_IDS),\n/* harmony export */   constructWebhookEvent: () => (/* binding */ constructWebhookEvent),\n/* harmony export */   createBillingPortalSession: () => (/* binding */ createBillingPortalSession),\n/* harmony export */   createCheckoutSession: () => (/* binding */ createCheckoutSession),\n/* harmony export */   createStripeCustomer: () => (/* binding */ createStripeCustomer),\n/* harmony export */   getCustomerSubscriptions: () => (/* binding */ getCustomerSubscriptions),\n/* harmony export */   getPlanTypeFromPriceId: () => (/* binding */ getPlanTypeFromPriceId),\n/* harmony export */   stripe: () => (/* binding */ stripe)\n/* harmony export */ });\n/* harmony import */ var stripe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! stripe */ \"stripe\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([stripe__WEBPACK_IMPORTED_MODULE_0__]);\nstripe__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// lib/stripe.ts\n\nconst stripe = new stripe__WEBPACK_IMPORTED_MODULE_0__[\"default\"](process.env.STRIPE_SECRET_KEY, {\n    apiVersion: '2023-10-16'\n});\nconst STRIPE_PRICE_IDS = {\n    monthly: \"price_1S2RxAJf7snkBYkO64nzHzcv\",\n    yearly: \"price_1S2S2XJf7snkBYkO44L3TrvL\",\n    lifetime: \"price_1S2S3zJf7snkBYkOAnc5J1LF\"\n};\nconst PLAN_DETAILS = {\n    monthly: {\n        name: 'Monthly Plan',\n        price: 5.99,\n        interval: 'month',\n        description: 'Full access to all BookfoldAR features'\n    },\n    yearly: {\n        name: 'Annual Plan',\n        price: 19.99,\n        interval: 'year',\n        description: 'Full access + 2 months free'\n    },\n    lifetime: {\n        name: 'Lifetime Plan',\n        price: 59.99,\n        interval: null,\n        description: 'Pay once, use forever'\n    }\n};\nasync function createStripeCustomer(email, name) {\n    try {\n        const customer = await stripe.customers.create({\n            email,\n            name,\n            metadata: {\n                app: 'bookfoldar'\n            }\n        });\n        return customer;\n    } catch (error) {\n        console.error('Error creating Stripe customer:', error);\n        return null;\n    }\n}\nasync function createCheckoutSession({ customerId, priceId, successUrl, cancelUrl, metadata = {} }) {\n    try {\n        const session = await stripe.checkout.sessions.create({\n            customer: customerId,\n            payment_method_types: [\n                'card'\n            ],\n            mode: priceId === STRIPE_PRICE_IDS.lifetime ? 'payment' : 'subscription',\n            line_items: [\n                {\n                    price: priceId,\n                    quantity: 1\n                }\n            ],\n            success_url: successUrl,\n            cancel_url: cancelUrl,\n            metadata: {\n                app: 'bookfoldar',\n                ...metadata\n            },\n            allow_promotion_codes: true,\n            billing_address_collection: 'auto',\n            ...priceId !== STRIPE_PRICE_IDS.lifetime && {\n                subscription_data: {\n                    metadata: {\n                        app: 'bookfoldar',\n                        ...metadata\n                    }\n                }\n            }\n        });\n        return session;\n    } catch (error) {\n        console.error('Error creating checkout session:', error);\n        return null;\n    }\n}\nasync function createBillingPortalSession(customerId, returnUrl) {\n    try {\n        const session = await stripe.billingPortal.sessions.create({\n            customer: customerId,\n            return_url: returnUrl\n        });\n        return session;\n    } catch (error) {\n        console.error('Error creating billing portal session:', error);\n        return null;\n    }\n}\nasync function getCustomerSubscriptions(customerId) {\n    try {\n        const subscriptions = await stripe.subscriptions.list({\n            customer: customerId,\n            status: 'all',\n            expand: [\n                'data.items.data.price'\n            ]\n        });\n        return subscriptions.data;\n    } catch (error) {\n        console.error('Error getting customer subscriptions:', error);\n        return [];\n    }\n}\nfunction getPlanTypeFromPriceId(priceId) {\n    for (const [planType, id] of Object.entries(STRIPE_PRICE_IDS)){\n        if (id === priceId) {\n            return planType;\n        }\n    }\n    return null;\n}\nfunction constructWebhookEvent(payload, signature, secret) {\n    try {\n        return stripe.webhooks.constructEvent(payload, signature, secret);\n    } catch (error) {\n        console.error('Error constructing webhook event:', error);\n        return null;\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T0FBZTtJQUNwRCxLQUFLLE1BQU0sQ0FBQzBCLFVBQVVDLEdBQUcsSUFBSUMsT0FBT0MsT0FBTyxDQUFDcEQsa0JBQW1CO1FBQzdELElBQUlrRCxPQUFPM0IsU0FBUztZQUNsQixPQUFPMEI7UUFDVDtJQUNGO0lBQ0EsT0FBTztBQUNUO0FBRU8sU0FBU0ksc0JBQ2RDLE9BQXdCLEVBQ3hCQyxTQUFpQixFQUNqQkMsTUFBYztJQUVkLElBQUk7UUFDRixPQUFPN0QsT0FBTzhELFFBQVEsQ0FBQ0MsY0FBYyxDQUFDSixTQUFTQyxXQUFXQztJQUM1RCxFQUFFLE9BQU9yQyxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQyxxQ0FBcUNBO1FBQ25ELE9BQU87SUFDVDtBQUNGIiwic291cmNlcyI6WyJDOlxcYXItYm9vay1mb2xkaW5nLWFzc2lzdGFudFxcbGliXFxzdHJpcGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL3N0cmlwZS50c1xyXG5pbXBvcnQgU3RyaXBlIGZyb20gJ3N0cmlwZSc7XHJcblxyXG5leHBvcnQgY29uc3Qgc3RyaXBlID0gbmV3IFN0cmlwZShwcm9jZXNzLmVudi5TVFJJUEVfU0VDUkVUX0tFWSEsIHtcclxuICBhcGlWZXJzaW9uOiAnMjAyMy0xMC0xNicsXHJcbn0pO1xyXG5cclxuZXhwb3J0IGNvbnN0IFNUUklQRV9QUklDRV9JRFMgPSB7XHJcbiAgbW9udGhseTogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1RSSVBFX1BSSUNFX01PTlRITFkhLFxyXG4gIHllYXJseTogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1RSSVBFX1BSSUNFX1lFQVJMWSEsXHJcbiAgbGlmZXRpbWU6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NUUklQRV9QUklDRV9MSUZFVElNRSEsXHJcbn0gYXMgY29uc3Q7XHJcblxyXG5leHBvcnQgdHlwZSBQbGFuVHlwZSA9IGtleW9mIHR5cGVvZiBTVFJJUEVfUFJJQ0VfSURTO1xyXG5cclxuZXhwb3J0IGNvbnN0IFBMQU5fREVUQUlMUyA9IHtcclxuICBtb250aGx5OiB7XHJcbiAgICBuYW1lOiAnTW9udGhseSBQbGFuJyxcclxuICAgIHByaWNlOiA1Ljk5LFxyXG4gICAgaW50ZXJ2YWw6ICdtb250aCcgYXMgY29uc3QsXHJcbiAgICBkZXNjcmlwdGlvbjogJ0Z1bGwgYWNjZXNzIHRvIGFsbCBCb29rZm9sZEFSIGZlYXR1cmVzJ1xyXG4gIH0sXHJcbiAgeWVhcmx5OiB7XHJcbiAgICBuYW1lOiAnQW5udWFsIFBsYW4nLCBcclxuICAgIHByaWNlOiAxOS45OSxcclxuICAgIGludGVydmFsOiAneWVhcicgYXMgY29uc3QsXHJcbiAgICBkZXNjcmlwdGlvbjogJ0Z1bGwgYWNjZXNzICsgMiBtb250aHMgZnJlZSdcclxuICB9LFxyXG4gIGxpZmV0aW1lOiB7XHJcbiAgICBuYW1lOiAnTGlmZXRpbWUgUGxhbicsXHJcbiAgICBwcmljZTogNTkuOTksXHJcbiAgICBpbnRlcnZhbDogbnVsbCxcclxuICAgIGRlc2NyaXB0aW9uOiAnUGF5IG9uY2UsIHVzZSBmb3JldmVyJ1xyXG4gIH1cclxufSBhcyBjb25zdDtcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVTdHJpcGVDdXN0b21lcihlbWFpbDogc3RyaW5nLCBuYW1lPzogc3RyaW5nKTogUHJvbWlzZTxTdHJpcGUuQ3VzdG9tZXIgfCBudWxsPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGN1c3RvbWVyID0gYXdhaXQgc3RyaXBlLmN1c3RvbWVycy5jcmVhdGUoe1xyXG4gICAgICBlbWFpbCxcclxuICAgICAgbmFtZSxcclxuICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICBhcHA6ICdib29rZm9sZGFyJ1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBjdXN0b21lcjtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgU3RyaXBlIGN1c3RvbWVyOicsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNoZWNrb3V0U2Vzc2lvbih7XHJcbiAgY3VzdG9tZXJJZCxcclxuICBwcmljZUlkLFxyXG4gIHN1Y2Nlc3NVcmwsXHJcbiAgY2FuY2VsVXJsLFxyXG4gIG1ldGFkYXRhID0ge31cclxufToge1xyXG4gIGN1c3RvbWVySWQ6IHN0cmluZztcclxuICBwcmljZUlkOiBzdHJpbmc7XHJcbiAgc3VjY2Vzc1VybDogc3RyaW5nO1xyXG4gIGNhbmNlbFVybDogc3RyaW5nO1xyXG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcclxufSk6IFByb21pc2U8U3RyaXBlLkNoZWNrb3V0LlNlc3Npb24gfCBudWxsPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBzdHJpcGUuY2hlY2tvdXQuc2Vzc2lvbnMuY3JlYXRlKHtcclxuICAgICAgY3VzdG9tZXI6IGN1c3RvbWVySWQsXHJcbiAgICAgIHBheW1lbnRfbWV0aG9kX3R5cGVzOiBbJ2NhcmQnXSxcclxuICAgICAgbW9kZTogcHJpY2VJZCA9PT0gU1RSSVBFX1BSSUNFX0lEUy5saWZldGltZSA/ICdwYXltZW50JyA6ICdzdWJzY3JpcHRpb24nLFxyXG4gICAgICBsaW5lX2l0ZW1zOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgcHJpY2U6IHByaWNlSWQsXHJcbiAgICAgICAgICBxdWFudGl0eTogMSxcclxuICAgICAgICB9LFxyXG4gICAgICBdLFxyXG4gICAgICBzdWNjZXNzX3VybDogc3VjY2Vzc1VybCxcclxuICAgICAgY2FuY2VsX3VybDogY2FuY2VsVXJsLFxyXG4gICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgIGFwcDogJ2Jvb2tmb2xkYXInLFxyXG4gICAgICAgIC4uLm1ldGFkYXRhXHJcbiAgICAgIH0sXHJcbiAgICAgIGFsbG93X3Byb21vdGlvbl9jb2RlczogdHJ1ZSxcclxuICAgICAgYmlsbGluZ19hZGRyZXNzX2NvbGxlY3Rpb246ICdhdXRvJyxcclxuICAgICAgLi4uKHByaWNlSWQgIT09IFNUUklQRV9QUklDRV9JRFMubGlmZXRpbWUgJiYge1xyXG4gICAgICAgIHN1YnNjcmlwdGlvbl9kYXRhOiB7XHJcbiAgICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgICBhcHA6ICdib29rZm9sZGFyJyxcclxuICAgICAgICAgICAgLi4ubWV0YWRhdGFcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHNlc3Npb247XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIGNoZWNrb3V0IHNlc3Npb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQmlsbGluZ1BvcnRhbFNlc3Npb24oXHJcbiAgY3VzdG9tZXJJZDogc3RyaW5nLFxyXG4gIHJldHVyblVybDogc3RyaW5nXHJcbik6IFByb21pc2U8U3RyaXBlLkJpbGxpbmdQb3J0YWwuU2Vzc2lvbiB8IG51bGw+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHN0cmlwZS5iaWxsaW5nUG9ydGFsLnNlc3Npb25zLmNyZWF0ZSh7XHJcbiAgICAgIGN1c3RvbWVyOiBjdXN0b21lcklkLFxyXG4gICAgICByZXR1cm5fdXJsOiByZXR1cm5VcmwsXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBzZXNzaW9uO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBiaWxsaW5nIHBvcnRhbCBzZXNzaW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyU3Vic2NyaXB0aW9ucyhjdXN0b21lcklkOiBzdHJpbmcpOiBQcm9taXNlPFN0cmlwZS5TdWJzY3JpcHRpb25bXT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdWJzY3JpcHRpb25zID0gYXdhaXQgc3RyaXBlLnN1YnNjcmlwdGlvbnMubGlzdCh7XHJcbiAgICAgIGN1c3RvbWVyOiBjdXN0b21lcklkLFxyXG4gICAgICBzdGF0dXM6ICdhbGwnLFxyXG4gICAgICBleHBhbmQ6IFsnZGF0YS5pdGVtcy5kYXRhLnByaWNlJ11cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHN1YnNjcmlwdGlvbnMuZGF0YTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyBjdXN0b21lciBzdWJzY3JpcHRpb25zOicsIGVycm9yKTtcclxuICAgIHJldHVybiBbXTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRQbGFuVHlwZUZyb21QcmljZUlkKHByaWNlSWQ6IHN0cmluZyk6IFBsYW5UeXBlIHwgbnVsbCB7XHJcbiAgZm9yIChjb25zdCBbcGxhblR5cGUsIGlkXSBvZiBPYmplY3QuZW50cmllcyhTVFJJUEVfUFJJQ0VfSURTKSkge1xyXG4gICAgaWYgKGlkID09PSBwcmljZUlkKSB7XHJcbiAgICAgIHJldHVybiBwbGFuVHlwZSBhcyBQbGFuVHlwZTtcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIG51bGw7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjb25zdHJ1Y3RXZWJob29rRXZlbnQoXHJcbiAgcGF5bG9hZDogc3RyaW5nIHwgQnVmZmVyLFxyXG4gIHNpZ25hdHVyZTogc3RyaW5nLFxyXG4gIHNlY3JldDogc3RyaW5nXHJcbik6IFN0cmlwZS5FdmVudCB8IG51bGwge1xyXG4gIHRyeSB7XHJcbiAgICByZXR1cm4gc3RyaXBlLndlYmhvb2tzLmNvbnN0cnVjdEV2ZW50KHBheWxvYWQsIHNpZ25hdHVyZSwgc2VjcmV0KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY29uc3RydWN0aW5nIHdlYmhvb2sgZXZlbnQ6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59Il0sIm5hbWVzIjpbIlN0cmlwZSIsInN0cmlwZSIsInByb2Nlc3MiLCJlbnYiLCJTVFJJUEVfU0VDUkVUX0tFWSIsImFwaVZlcnNpb24iLCJTVFJJUEVfUFJJQ0VfSURTIiwibW9udGhseSIsIk5FWFRfUFVCTElDX1NUUklQRV9QUklDRV9NT05USExZIiwieWVhcmx5IiwiTkVYVF9QVUJMSUNfU1RSSVBFX1BSSUNFX1lFQVJMWSIsImxpZmV0aW1lIiwiTkVYVF9QVUJMSUNfU1RSSVBFX1BSSUNFX0xJRkVUSU1FIiwiUExBTl9ERVRBSUxTIiwibmFtZSIsInByaWNlIiwiaW50ZXJ2YWwiLCJkZXNjcmlwdGlvbiIsImNyZWF0ZVN0cmlwZUN1c3RvbWVyIiwiZW1haWwiLCJjdXN0b21lciIsImN1c3RvbWVycyIsImNyZWF0ZSIsIm1ldGFkYXRhIiwiYXBwIiwiZXJyb3IiLCJjb25zb2xlIiwiY3JlYXRlQ2hlY2tvdXRTZXNzaW9uIiwiY3VzdG9tZXJJZCIsInByaWNlSWQiLCJzdWNjZXNzVXJsIiwiY2FuY2VsVXJsIiwic2Vzc2lvbiIsImNoZWNrb3V0Iiwic2Vzc2lvbnMiLCJwYXltZW50X21ldGhvZF90eXBlcyIsIm1vZGUiLCJsaW5lX2l0ZW1zIiwicXVhbnRpdHkiLCJzdWNjZXNzX3VybCIsImNhbmNlbF91cmwiLCJhbGxvd19wcm9tb3Rpb25fY29kZXMiLCJiaWxsaW5nX2FkZHJlc3NfY29sbGVjdGlvbiIsInN1YnNjcmlwdGlvbl9kYXRhIiwiY3JlYXRlQmlsbGluZ1BvcnRhbFNlc3Npb24iLCJyZXR1cm5VcmwiLCJiaWxsaW5nUG9ydGFsIiwicmV0dXJuX3VybCIsImdldEN1c3RvbWVyU3Vic2NyaXB0aW9ucyIsInN1YnNjcmlwdGlvbnMiLCJsaXN0Iiwic3RhdHVzIiwiZXhwYW5kIiwiZGF0YSIsImdldFBsYW5UeXBlRnJvbVByaWNlSWQiLCJwbGFuVHlwZSIsImlkIiwiT2JqZWN0IiwiZW50cmllcyIsImNvbnN0cnVjdFdlYmhvb2tFdmVudCIsInBheWxvYWQiLCJzaWduYXR1cmUiLCJzZWNyZXQiLCJ3ZWJob29rcyIsImNvbnN0cnVjdEV2ZW50Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/stripe.ts\n");

/***/ }),

/***/ "(api-node)/./lib/supabase.ts":
/*!*************************!*\
  !*** ./lib/supabase.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createPayment: () => (/* binding */ createPayment),\n/* harmony export */   createSubscription: () => (/* binding */ createSubscription),\n/* harmony export */   getSubscriptionByStripeId: () => (/* binding */ getSubscriptionByStripeId),\n/* harmony export */   getUserByEmail: () => (/* binding */ getUserByEmail),\n/* harmony export */   getUserByStripeCustomerId: () => (/* binding */ getUserByStripeCustomerId),\n/* harmony export */   getUserSubscriptionStatus: () => (/* binding */ getUserSubscriptionStatus),\n/* harmony export */   isEventProcessed: () => (/* binding */ isEventProcessed),\n/* harmony export */   markEventProcessed: () => (/* binding */ markEventProcessed),\n/* harmony export */   recordStripeEvent: () => (/* binding */ recordStripeEvent),\n/* harmony export */   startTrial: () => (/* binding */ startTrial),\n/* harmony export */   supabase: () => (/* binding */ supabase),\n/* harmony export */   supabaseAdmin: () => (/* binding */ supabaseAdmin),\n/* harmony export */   updatePayment: () => (/* binding */ updatePayment),\n/* harmony export */   updateSubscription: () => (/* binding */ updateSubscription),\n/* harmony export */   upsertUser: () => (/* binding */ upsertUser)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__);\n// lib/supabase.ts\n\nconst supabaseUrl = \"https://mpcmqjxmnhlozrdmlkts.supabase.co\";\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1wY21xanhtbmhsb3pyZG1sa3RzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczNjk2ODEsImV4cCI6MjA3Mjk0NTY4MX0.Q3Pz8muPICb8Omrzaf247LAXP6Alx0WdbEb_0DwE9Nk\";\n// Client for server-side operations (admin)\nconst supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceKey, {\n    auth: {\n        autoRefreshToken: false,\n        persistSession: false\n    }\n});\n// Client for client-side operations\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\n// Stripe Events / Idempotency Functions\nasync function recordStripeEvent(stripeEventId, eventType, data, apiVersion) {\n    try {\n        console.log(`Recording Stripe event: ${stripeEventId} (${eventType})`);\n        const { data: result, error } = await supabaseAdmin.from('stripe_events').insert({\n            stripe_event_id: stripeEventId,\n            event_type: eventType,\n            data,\n            api_version: apiVersion,\n            processed: false\n        }).select().single();\n        if (error) {\n            // If it's a unique constraint violation, the event already exists\n            if (error.code === '23505') {\n                console.log(`Stripe event ${stripeEventId} already recorded`);\n                return false; // Event already exists\n            }\n            console.error('Error recording Stripe event:', error);\n            return false;\n        }\n        console.log(`Successfully recorded event: ${stripeEventId}`);\n        return true; // New event, proceed with processing\n    } catch (error) {\n        console.error('Error recording Stripe event:', error);\n        return false;\n    }\n}\nasync function markEventProcessed(stripeEventId) {\n    try {\n        console.log(`Marking event as processed: ${stripeEventId}`);\n        const { error } = await supabaseAdmin.from('stripe_events').update({\n            processed: true,\n            processed_at: new Date().toISOString()\n        }).eq('stripe_event_id', stripeEventId);\n        if (error) {\n            console.error('Error marking event as processed:', error);\n            return false;\n        }\n        console.log(`Successfully marked event as processed: ${stripeEventId}`);\n        return true;\n    } catch (error) {\n        console.error('Error marking event as processed:', error);\n        return false;\n    }\n}\nasync function isEventProcessed(stripeEventId) {\n    try {\n        console.log(`Checking if event is processed: ${stripeEventId}`);\n        const { data, error } = await supabaseAdmin.from('stripe_events').select('processed').eq('stripe_event_id', stripeEventId).single();\n        if (error) {\n            // If event not found, it hasn't been processed\n            if (error.code === 'PGRST116') {\n                console.log(`Event ${stripeEventId} not found in database`);\n                return false;\n            }\n            console.error('Error checking if event is processed:', error);\n            return false;\n        }\n        const isProcessed = data?.processed === true;\n        console.log(`Event ${stripeEventId} processed status: ${isProcessed}`);\n        return isProcessed;\n    } catch (error) {\n        console.error('Error checking if event is processed:', error);\n        return false;\n    }\n}\n// User Management Functions\nasync function getUserSubscriptionStatus(email) {\n    try {\n        const { data, error } = await supabaseAdmin.rpc('get_user_subscription_status', {\n            user_email: email\n        });\n        if (error) {\n            console.error('Error getting user subscription status:', error);\n            return null;\n        }\n        return data?.[0] || null;\n    } catch (error) {\n        console.error('Error calling get_user_subscription_status:', error);\n        return null;\n    }\n}\nasync function upsertUser(email, stripeCustomerId) {\n    try {\n        const { data, error } = await supabaseAdmin.rpc('upsert_user', {\n            user_email: email,\n            stripe_customer_id: stripeCustomerId\n        });\n        if (error) {\n            console.error('Error upserting user:', error);\n            return null;\n        }\n        return data;\n    } catch (error) {\n        console.error('Error calling upsert_user:', error);\n        return null;\n    }\n}\nasync function startTrial(email) {\n    try {\n        const { data, error } = await supabaseAdmin.rpc('start_trial', {\n            user_email: email\n        });\n        if (error) {\n            console.error('Error starting trial:', error);\n            return false;\n        }\n        return data === true;\n    } catch (error) {\n        console.error('Error calling start_trial:', error);\n        return false;\n    }\n}\nasync function getUserByEmail(email) {\n    try {\n        const { data, error } = await supabaseAdmin.from('users').select('*').eq('email', email).single();\n        if (error) {\n            console.error('Error getting user by email:', error);\n            return null;\n        }\n        return data;\n    } catch (error) {\n        console.error('Error getting user by email:', error);\n        return null;\n    }\n}\nasync function getUserByStripeCustomerId(customerId) {\n    try {\n        const { data, error } = await supabaseAdmin.from('users').select('*').eq('stripe_customer_id', customerId).single();\n        if (error) {\n            console.error('Error getting user by stripe customer ID:', error);\n            return null;\n        }\n        return data;\n    } catch (error) {\n        console.error('Error getting user by stripe customer ID:', error);\n        return null;\n    }\n}\n// Subscription Management Functions\nasync function createSubscription(subscription) {\n    try {\n        console.log('Creating subscription:', subscription);\n        const { data, error } = await supabaseAdmin.from('subscriptions').insert(subscription).select().single();\n        if (error) {\n            console.error('Error creating subscription:', error);\n            return null;\n        }\n        console.log('Successfully created subscription:', data.id);\n        return data;\n    } catch (error) {\n        console.error('Error creating subscription:', error);\n        return null;\n    }\n}\nasync function updateSubscription(stripeSubscriptionId, updates) {\n    try {\n        console.log(`Updating subscription: ${stripeSubscriptionId}`, updates);\n        const { data, error } = await supabaseAdmin.from('subscriptions').update(updates).eq('stripe_subscription_id', stripeSubscriptionId).select().single();\n        if (error) {\n            console.error('Error updating subscription:', error);\n            return null;\n        }\n        console.log('Successfully updated subscription:', data.id);\n        return data;\n    } catch (error) {\n        console.error('Error updating subscription:', error);\n        return null;\n    }\n}\nasync function getSubscriptionByStripeId(stripeSubscriptionId) {\n    try {\n        const { data, error } = await supabaseAdmin.from('subscriptions').select('*').eq('stripe_subscription_id', stripeSubscriptionId).single();\n        if (error) {\n            console.error('Error getting subscription by Stripe ID:', error);\n            return null;\n        }\n        return data;\n    } catch (error) {\n        console.error('Error getting subscription by Stripe ID:', error);\n        return null;\n    }\n}\n// Payment Management Functions\nasync function createPayment(payment) {\n    try {\n        console.log('Creating payment record:', payment.stripe_payment_intent_id);\n        const { data, error } = await supabaseAdmin.from('payments').insert(payment).select().single();\n        if (error) {\n            console.error('Error creating payment record:', error);\n            return null;\n        }\n        console.log('Successfully created payment record:', data.id);\n        return data;\n    } catch (error) {\n        console.error('Error creating payment record:', error);\n        return null;\n    }\n}\nasync function updatePayment(paymentIntentId, updates) {\n    try {\n        const { data, error } = await supabaseAdmin.from('payments').update(updates).eq('stripe_payment_intent_id', paymentIntentId).select().single();\n        if (error) {\n            console.error('Error updating payment:', error);\n            return null;\n        }\n        return data;\n    } catch (error) {\n        console.error('Error updating payment:', error);\n        return null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9zdXBhYmFzZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLGtCQUFrQjtBQUNtQztBQUVyRCxNQUFNQyxjQUFjQywwQ0FBb0M7QUFDeEQsTUFBTUcscUJBQXFCSCxRQUFRQyxHQUFHLENBQUNHLHlCQUF5QjtBQUNoRSxNQUFNQyxrQkFBa0JMLGtOQUF5QztBQUVqRSw0Q0FBNEM7QUFDckMsTUFBTU8sZ0JBQWdCVCxtRUFBWUEsQ0FBQ0MsYUFBYUksb0JBQW9CO0lBQ3pFSyxNQUFNO1FBQ0pDLGtCQUFrQjtRQUNsQkMsZ0JBQWdCO0lBQ2xCO0FBQ0YsR0FBRztBQUVILG9DQUFvQztBQUM3QixNQUFNQyxXQUFXYixtRUFBWUEsQ0FBQ0MsYUFBYU0saUJBQWlCO0FBK0RuRSx3Q0FBd0M7QUFDakMsZUFBZU8sa0JBQ3BCQyxhQUFxQixFQUNyQkMsU0FBaUIsRUFDakJDLElBQTBCLEVBQzFCQyxVQUFtQjtJQUVuQixJQUFJO1FBQ0ZDLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLHdCQUF3QixFQUFFTCxjQUFjLEVBQUUsRUFBRUMsVUFBVSxDQUFDLENBQUM7UUFFckUsTUFBTSxFQUFFQyxNQUFNSSxNQUFNLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1iLGNBQ25DYyxJQUFJLENBQUMsaUJBQ0xDLE1BQU0sQ0FBQztZQUNOQyxpQkFBaUJWO1lBQ2pCVyxZQUFZVjtZQUNaQztZQUNBVSxhQUFhVDtZQUNiVSxXQUFXO1FBQ2IsR0FDQ0MsTUFBTSxHQUNOQyxNQUFNO1FBRVQsSUFBSVIsT0FBTztZQUNULGtFQUFrRTtZQUNsRSxJQUFJQSxNQUFNUyxJQUFJLEtBQUssU0FBUztnQkFDMUJaLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLGFBQWEsRUFBRUwsY0FBYyxpQkFBaUIsQ0FBQztnQkFDNUQsT0FBTyxPQUFPLHVCQUF1QjtZQUN2QztZQUNBSSxRQUFRRyxLQUFLLENBQUMsaUNBQWlDQTtZQUMvQyxPQUFPO1FBQ1Q7UUFFQUgsUUFBUUMsR0FBRyxDQUFDLENBQUMsNkJBQTZCLEVBQUVMLGVBQWU7UUFDM0QsT0FBTyxNQUFNLHFDQUFxQztJQUNwRCxFQUFFLE9BQU9PLE9BQU87UUFDZEgsUUFBUUcsS0FBSyxDQUFDLGlDQUFpQ0E7UUFDL0MsT0FBTztJQUNUO0FBQ0Y7QUFFTyxlQUFlVSxtQkFBbUJqQixhQUFxQjtJQUM1RCxJQUFJO1FBQ0ZJLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLDRCQUE0QixFQUFFTCxlQUFlO1FBRTFELE1BQU0sRUFBRU8sS0FBSyxFQUFFLEdBQUcsTUFBTWIsY0FDckJjLElBQUksQ0FBQyxpQkFDTFUsTUFBTSxDQUFDO1lBQ05MLFdBQVc7WUFDWE0sY0FBYyxJQUFJQyxPQUFPQyxXQUFXO1FBQ3RDLEdBQ0NDLEVBQUUsQ0FBQyxtQkFBbUJ0QjtRQUV6QixJQUFJTyxPQUFPO1lBQ1RILFFBQVFHLEtBQUssQ0FBQyxxQ0FBcUNBO1lBQ25ELE9BQU87UUFDVDtRQUVBSCxRQUFRQyxHQUFHLENBQUMsQ0FBQyx3Q0FBd0MsRUFBRUwsZUFBZTtRQUN0RSxPQUFPO0lBQ1QsRUFBRSxPQUFPTyxPQUFPO1FBQ2RILFFBQVFHLEtBQUssQ0FBQyxxQ0FBcUNBO1FBQ25ELE9BQU87SUFDVDtBQUNGO0FBRU8sZUFBZWdCLGlCQUFpQnZCLGFBQXFCO0lBQzFELElBQUk7UUFDRkksUUFBUUMsR0FBRyxDQUFDLENBQUMsZ0NBQWdDLEVBQUVMLGVBQWU7UUFFOUQsTUFBTSxFQUFFRSxJQUFJLEVBQUVLLEtBQUssRUFBRSxHQUFHLE1BQU1iLGNBQzNCYyxJQUFJLENBQUMsaUJBQ0xNLE1BQU0sQ0FBQyxhQUNQUSxFQUFFLENBQUMsbUJBQW1CdEIsZUFDdEJlLE1BQU07UUFFVCxJQUFJUixPQUFPO1lBQ1QsK0NBQStDO1lBQy9DLElBQUlBLE1BQU1TLElBQUksS0FBSyxZQUFZO2dCQUM3QlosUUFBUUMsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUFFTCxjQUFjLHNCQUFzQixDQUFDO2dCQUMxRCxPQUFPO1lBQ1Q7WUFDQUksUUFBUUcsS0FBSyxDQUFDLHlDQUF5Q0E7WUFDdkQsT0FBTztRQUNUO1FBRUEsTUFBTWlCLGNBQWN0QixNQUFNVyxjQUFjO1FBQ3hDVCxRQUFRQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUVMLGNBQWMsbUJBQW1CLEVBQUV3QixhQUFhO1FBQ3JFLE9BQU9BO0lBQ1QsRUFBRSxPQUFPakIsT0FBTztRQUNkSCxRQUFRRyxLQUFLLENBQUMseUNBQXlDQTtRQUN2RCxPQUFPO0lBQ1Q7QUFDRjtBQUVBLDRCQUE0QjtBQUNyQixlQUFla0IsMEJBQTBCQyxLQUFhO0lBQzNELElBQUk7UUFDRixNQUFNLEVBQUV4QixJQUFJLEVBQUVLLEtBQUssRUFBRSxHQUFHLE1BQU1iLGNBQWNpQyxHQUFHLENBQUMsZ0NBQWdDO1lBQzlFQyxZQUFZRjtRQUNkO1FBRUEsSUFBSW5CLE9BQU87WUFDVEgsUUFBUUcsS0FBSyxDQUFDLDJDQUEyQ0E7WUFDekQsT0FBTztRQUNUO1FBRUEsT0FBT0wsTUFBTSxDQUFDLEVBQUUsSUFBSTtJQUN0QixFQUFFLE9BQU9LLE9BQU87UUFDZEgsUUFBUUcsS0FBSyxDQUFDLCtDQUErQ0E7UUFDN0QsT0FBTztJQUNUO0FBQ0Y7QUFFTyxlQUFlc0IsV0FBV0gsS0FBYSxFQUFFSSxnQkFBeUI7SUFDdkUsSUFBSTtRQUNGLE1BQU0sRUFBRTVCLElBQUksRUFBRUssS0FBSyxFQUFFLEdBQUcsTUFBTWIsY0FBY2lDLEdBQUcsQ0FBQyxlQUFlO1lBQzdEQyxZQUFZRjtZQUNaSyxvQkFBb0JEO1FBQ3RCO1FBRUEsSUFBSXZCLE9BQU87WUFDVEgsUUFBUUcsS0FBSyxDQUFDLHlCQUF5QkE7WUFDdkMsT0FBTztRQUNUO1FBRUEsT0FBT0w7SUFDVCxFQUFFLE9BQU9LLE9BQU87UUFDZEgsUUFBUUcsS0FBSyxDQUFDLDhCQUE4QkE7UUFDNUMsT0FBTztJQUNUO0FBQ0Y7QUFFTyxlQUFleUIsV0FBV04sS0FBYTtJQUM1QyxJQUFJO1FBQ0YsTUFBTSxFQUFFeEIsSUFBSSxFQUFFSyxLQUFLLEVBQUUsR0FBRyxNQUFNYixjQUFjaUMsR0FBRyxDQUFDLGVBQWU7WUFDN0RDLFlBQVlGO1FBQ2Q7UUFFQSxJQUFJbkIsT0FBTztZQUNUSCxRQUFRRyxLQUFLLENBQUMseUJBQXlCQTtZQUN2QyxPQUFPO1FBQ1Q7UUFFQSxPQUFPTCxTQUFTO0lBQ2xCLEVBQUUsT0FBT0ssT0FBTztRQUNkSCxRQUFRRyxLQUFLLENBQUMsOEJBQThCQTtRQUM1QyxPQUFPO0lBQ1Q7QUFDRjtBQUVPLGVBQWUwQixlQUFlUCxLQUFhO0lBQ2hELElBQUk7UUFDRixNQUFNLEVBQUV4QixJQUFJLEVBQUVLLEtBQUssRUFBRSxHQUFHLE1BQU1iLGNBQzNCYyxJQUFJLENBQUMsU0FDTE0sTUFBTSxDQUFDLEtBQ1BRLEVBQUUsQ0FBQyxTQUFTSSxPQUNaWCxNQUFNO1FBRVQsSUFBSVIsT0FBTztZQUNUSCxRQUFRRyxLQUFLLENBQUMsZ0NBQWdDQTtZQUM5QyxPQUFPO1FBQ1Q7UUFFQSxPQUFPTDtJQUNULEVBQUUsT0FBT0ssT0FBTztRQUNkSCxRQUFRRyxLQUFLLENBQUMsZ0NBQWdDQTtRQUM5QyxPQUFPO0lBQ1Q7QUFDRjtBQUVPLGVBQWUyQiwwQkFBMEJDLFVBQWtCO0lBQ2hFLElBQUk7UUFDRixNQUFNLEVBQUVqQyxJQUFJLEVBQUVLLEtBQUssRUFBRSxHQUFHLE1BQU1iLGNBQzNCYyxJQUFJLENBQUMsU0FDTE0sTUFBTSxDQUFDLEtBQ1BRLEVBQUUsQ0FBQyxzQkFBc0JhLFlBQ3pCcEIsTUFBTTtRQUVULElBQUlSLE9BQU87WUFDVEgsUUFBUUcsS0FBSyxDQUFDLDZDQUE2Q0E7WUFDM0QsT0FBTztRQUNUO1FBRUEsT0FBT0w7SUFDVCxFQUFFLE9BQU9LLE9BQU87UUFDZEgsUUFBUUcsS0FBSyxDQUFDLDZDQUE2Q0E7UUFDM0QsT0FBTztJQUNUO0FBQ0Y7QUFFQSxvQ0FBb0M7QUFDN0IsZUFBZTZCLG1CQUFtQkMsWUFBb0U7SUFDM0csSUFBSTtRQUNGakMsUUFBUUMsR0FBRyxDQUFDLDBCQUEwQmdDO1FBRXRDLE1BQU0sRUFBRW5DLElBQUksRUFBRUssS0FBSyxFQUFFLEdBQUcsTUFBTWIsY0FDM0JjLElBQUksQ0FBQyxpQkFDTEMsTUFBTSxDQUFDNEIsY0FDUHZCLE1BQU0sR0FDTkMsTUFBTTtRQUVULElBQUlSLE9BQU87WUFDVEgsUUFBUUcsS0FBSyxDQUFDLGdDQUFnQ0E7WUFDOUMsT0FBTztRQUNUO1FBRUFILFFBQVFDLEdBQUcsQ0FBQyxzQ0FBc0NILEtBQUtvQyxFQUFFO1FBQ3pELE9BQU9wQztJQUNULEVBQUUsT0FBT0ssT0FBTztRQUNkSCxRQUFRRyxLQUFLLENBQUMsZ0NBQWdDQTtRQUM5QyxPQUFPO0lBQ1Q7QUFDRjtBQUVPLGVBQWVnQyxtQkFDcEJDLG9CQUE0QixFQUM1QkMsT0FBOEI7SUFFOUIsSUFBSTtRQUNGckMsUUFBUUMsR0FBRyxDQUFDLENBQUMsdUJBQXVCLEVBQUVtQyxzQkFBc0IsRUFBRUM7UUFFOUQsTUFBTSxFQUFFdkMsSUFBSSxFQUFFSyxLQUFLLEVBQUUsR0FBRyxNQUFNYixjQUMzQmMsSUFBSSxDQUFDLGlCQUNMVSxNQUFNLENBQUN1QixTQUNQbkIsRUFBRSxDQUFDLDBCQUEwQmtCLHNCQUM3QjFCLE1BQU0sR0FDTkMsTUFBTTtRQUVULElBQUlSLE9BQU87WUFDVEgsUUFBUUcsS0FBSyxDQUFDLGdDQUFnQ0E7WUFDOUMsT0FBTztRQUNUO1FBRUFILFFBQVFDLEdBQUcsQ0FBQyxzQ0FBc0NILEtBQUtvQyxFQUFFO1FBQ3pELE9BQU9wQztJQUNULEVBQUUsT0FBT0ssT0FBTztRQUNkSCxRQUFRRyxLQUFLLENBQUMsZ0NBQWdDQTtRQUM5QyxPQUFPO0lBQ1Q7QUFDRjtBQUVPLGVBQWVtQywwQkFBMEJGLG9CQUE0QjtJQUMxRSxJQUFJO1FBQ0YsTUFBTSxFQUFFdEMsSUFBSSxFQUFFSyxLQUFLLEVBQUUsR0FBRyxNQUFNYixjQUMzQmMsSUFBSSxDQUFDLGlCQUNMTSxNQUFNLENBQUMsS0FDUFEsRUFBRSxDQUFDLDBCQUEwQmtCLHNCQUM3QnpCLE1BQU07UUFFVCxJQUFJUixPQUFPO1lBQ1RILFFBQVFHLEtBQUssQ0FBQyw0Q0FBNENBO1lBQzFELE9BQU87UUFDVDtRQUVBLE9BQU9MO0lBQ1QsRUFBRSxPQUFPSyxPQUFPO1FBQ2RILFFBQVFHLEtBQUssQ0FBQyw0Q0FBNENBO1FBQzFELE9BQU87SUFDVDtBQUNGO0FBRUEsK0JBQStCO0FBQ3hCLGVBQWVvQyxjQUFjQyxPQUEyQztJQUM3RSxJQUFJO1FBQ0Z4QyxRQUFRQyxHQUFHLENBQUMsNEJBQTRCdUMsUUFBUUMsd0JBQXdCO1FBRXhFLE1BQU0sRUFBRTNDLElBQUksRUFBRUssS0FBSyxFQUFFLEdBQUcsTUFBTWIsY0FDM0JjLElBQUksQ0FBQyxZQUNMQyxNQUFNLENBQUNtQyxTQUNQOUIsTUFBTSxHQUNOQyxNQUFNO1FBRVQsSUFBSVIsT0FBTztZQUNUSCxRQUFRRyxLQUFLLENBQUMsa0NBQWtDQTtZQUNoRCxPQUFPO1FBQ1Q7UUFFQUgsUUFBUUMsR0FBRyxDQUFDLHdDQUF3Q0gsS0FBS29DLEVBQUU7UUFDM0QsT0FBT3BDO0lBQ1QsRUFBRSxPQUFPSyxPQUFPO1FBQ2RILFFBQVFHLEtBQUssQ0FBQyxrQ0FBa0NBO1FBQ2hELE9BQU87SUFDVDtBQUNGO0FBRU8sZUFBZXVDLGNBQ3BCQyxlQUF1QixFQUN2Qk4sT0FBeUI7SUFFekIsSUFBSTtRQUNGLE1BQU0sRUFBRXZDLElBQUksRUFBRUssS0FBSyxFQUFFLEdBQUcsTUFBTWIsY0FDM0JjLElBQUksQ0FBQyxZQUNMVSxNQUFNLENBQUN1QixTQUNQbkIsRUFBRSxDQUFDLDRCQUE0QnlCLGlCQUMvQmpDLE1BQU0sR0FDTkMsTUFBTTtRQUVULElBQUlSLE9BQU87WUFDVEgsUUFBUUcsS0FBSyxDQUFDLDJCQUEyQkE7WUFDekMsT0FBTztRQUNUO1FBRUEsT0FBT0w7SUFDVCxFQUFFLE9BQU9LLE9BQU87UUFDZEgsUUFBUUcsS0FBSyxDQUFDLDJCQUEyQkE7UUFDekMsT0FBTztJQUNUO0FBQ0YiLCJzb3VyY2VzIjpbIkM6XFxhci1ib29rLWZvbGRpbmctYXNzaXN0YW50XFxsaWJcXHN1cGFiYXNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGxpYi9zdXBhYmFzZS50c1xyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xyXG5cclxuY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhO1xyXG5jb25zdCBzdXBhYmFzZVNlcnZpY2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZITtcclxuY29uc3Qgc3VwYWJhc2VBbm9uS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkhO1xyXG5cclxuLy8gQ2xpZW50IGZvciBzZXJ2ZXItc2lkZSBvcGVyYXRpb25zIChhZG1pbilcclxuZXhwb3J0IGNvbnN0IHN1cGFiYXNlQWRtaW4gPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlU2VydmljZUtleSwge1xyXG4gIGF1dGg6IHtcclxuICAgIGF1dG9SZWZyZXNoVG9rZW46IGZhbHNlLFxyXG4gICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxyXG4gIH0sXHJcbn0pO1xyXG5cclxuLy8gQ2xpZW50IGZvciBjbGllbnQtc2lkZSBvcGVyYXRpb25zXHJcbmV4cG9ydCBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5KTtcclxuXHJcbi8vIFR5cGVzIGZvciBkYXRhYmFzZSB0YWJsZXNcclxuZXhwb3J0IGludGVyZmFjZSBVc2VyIHtcclxuICBpZDogc3RyaW5nO1xyXG4gIGVtYWlsOiBzdHJpbmc7XHJcbiAgY3JlYXRlZF9hdDogc3RyaW5nO1xyXG4gIHVwZGF0ZWRfYXQ6IHN0cmluZztcclxuICBzdHJpcGVfY3VzdG9tZXJfaWQ/OiBzdHJpbmc7XHJcbiAgdHJpYWxfc3RhcnRfZGF0ZT86IHN0cmluZztcclxuICB0cmlhbF9lbmRfZGF0ZT86IHN0cmluZztcclxuICB0cmlhbF91c2VkOiBib29sZWFuO1xyXG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBTdWJzY3JpcHRpb24ge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgdXNlcl9pZDogc3RyaW5nO1xyXG4gIHN0cmlwZV9zdWJzY3JpcHRpb25faWQ/OiBzdHJpbmc7XHJcbiAgc3RyaXBlX3ByaWNlX2lkOiBzdHJpbmc7XHJcbiAgc3RhdHVzOiAnaW5jb21wbGV0ZScgfCAnaW5jb21wbGV0ZV9leHBpcmVkJyB8ICd0cmlhbGluZycgfCAnYWN0aXZlJyB8ICdwYXN0X2R1ZScgfCAnY2FuY2VsZWQnIHwgJ3VucGFpZCc7XHJcbiAgcGxhbl90eXBlOiAnbW9udGhseScgfCAneWVhcmx5JyB8ICdsaWZldGltZSc7XHJcbiAgY3VycmVudF9wZXJpb2Rfc3RhcnQ/OiBzdHJpbmc7XHJcbiAgY3VycmVudF9wZXJpb2RfZW5kPzogc3RyaW5nO1xyXG4gIGNhbmNlbF9hdF9wZXJpb2RfZW5kOiBib29sZWFuO1xyXG4gIGNhbmNlbGVkX2F0Pzogc3RyaW5nO1xyXG4gIGNyZWF0ZWRfYXQ6IHN0cmluZztcclxuICB1cGRhdGVkX2F0OiBzdHJpbmc7XHJcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFBheW1lbnQge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgdXNlcl9pZDogc3RyaW5nO1xyXG4gIHN1YnNjcmlwdGlvbl9pZD86IHN0cmluZztcclxuICBzdHJpcGVfcGF5bWVudF9pbnRlbnRfaWQ/OiBzdHJpbmc7XHJcbiAgYW1vdW50OiBudW1iZXI7XHJcbiAgY3VycmVuY3k6IHN0cmluZztcclxuICBzdGF0dXM6IHN0cmluZztcclxuICBjcmVhdGVkX2F0OiBzdHJpbmc7XHJcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFN0cmlwZUV2ZW50IHtcclxuICBpZDogc3RyaW5nO1xyXG4gIHN0cmlwZV9ldmVudF9pZDogc3RyaW5nO1xyXG4gIGV2ZW50X3R5cGU6IHN0cmluZztcclxuICBwcm9jZXNzZWQ6IGJvb2xlYW47XHJcbiAgcHJvY2Vzc2VkX2F0Pzogc3RyaW5nO1xyXG4gIGNyZWF0ZWRfYXQ6IHN0cmluZztcclxuICBhcGlfdmVyc2lvbj86IHN0cmluZztcclxuICBkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcclxuICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVXNlclN1YnNjcmlwdGlvblN0YXR1cyB7XHJcbiAgaGFzX2FjdGl2ZV9zdWJzY3JpcHRpb246IGJvb2xlYW47XHJcbiAgc3Vic2NyaXB0aW9uX3N0YXR1czogc3RyaW5nO1xyXG4gIHBsYW5fdHlwZTogc3RyaW5nO1xyXG4gIHRyaWFsX2FjdGl2ZTogYm9vbGVhbjtcclxuICB0cmlhbF9kYXlzX3JlbWFpbmluZzogbnVtYmVyO1xyXG59XHJcblxyXG4vLyBTdHJpcGUgRXZlbnRzIC8gSWRlbXBvdGVuY3kgRnVuY3Rpb25zXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZWNvcmRTdHJpcGVFdmVudChcclxuICBzdHJpcGVFdmVudElkOiBzdHJpbmcsXHJcbiAgZXZlbnRUeXBlOiBzdHJpbmcsXHJcbiAgZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT4sXHJcbiAgYXBpVmVyc2lvbj86IHN0cmluZ1xyXG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICB0cnkge1xyXG4gICAgY29uc29sZS5sb2coYFJlY29yZGluZyBTdHJpcGUgZXZlbnQ6ICR7c3RyaXBlRXZlbnRJZH0gKCR7ZXZlbnRUeXBlfSlgKTtcclxuICAgIFxyXG4gICAgY29uc3QgeyBkYXRhOiByZXN1bHQsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzdHJpcGVfZXZlbnRzJylcclxuICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgc3RyaXBlX2V2ZW50X2lkOiBzdHJpcGVFdmVudElkLFxyXG4gICAgICAgIGV2ZW50X3R5cGU6IGV2ZW50VHlwZSxcclxuICAgICAgICBkYXRhLFxyXG4gICAgICAgIGFwaV92ZXJzaW9uOiBhcGlWZXJzaW9uLFxyXG4gICAgICAgIHByb2Nlc3NlZDogZmFsc2VcclxuICAgICAgfSlcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgLy8gSWYgaXQncyBhIHVuaXF1ZSBjb25zdHJhaW50IHZpb2xhdGlvbiwgdGhlIGV2ZW50IGFscmVhZHkgZXhpc3RzXHJcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSAnMjM1MDUnKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYFN0cmlwZSBldmVudCAke3N0cmlwZUV2ZW50SWR9IGFscmVhZHkgcmVjb3JkZWRgKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEV2ZW50IGFscmVhZHkgZXhpc3RzXHJcbiAgICAgIH1cclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcmVjb3JkaW5nIFN0cmlwZSBldmVudDonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZyhgU3VjY2Vzc2Z1bGx5IHJlY29yZGVkIGV2ZW50OiAke3N0cmlwZUV2ZW50SWR9YCk7XHJcbiAgICByZXR1cm4gdHJ1ZTsgLy8gTmV3IGV2ZW50LCBwcm9jZWVkIHdpdGggcHJvY2Vzc2luZ1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZWNvcmRpbmcgU3RyaXBlIGV2ZW50OicsIGVycm9yKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtYXJrRXZlbnRQcm9jZXNzZWQoc3RyaXBlRXZlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnNvbGUubG9nKGBNYXJraW5nIGV2ZW50IGFzIHByb2Nlc3NlZDogJHtzdHJpcGVFdmVudElkfWApO1xyXG4gICAgXHJcbiAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzdHJpcGVfZXZlbnRzJylcclxuICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgcHJvY2Vzc2VkOiB0cnVlLFxyXG4gICAgICAgIHByb2Nlc3NlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgIH0pXHJcbiAgICAgIC5lcSgnc3RyaXBlX2V2ZW50X2lkJywgc3RyaXBlRXZlbnRJZCk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIG1hcmtpbmcgZXZlbnQgYXMgcHJvY2Vzc2VkOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKGBTdWNjZXNzZnVsbHkgbWFya2VkIGV2ZW50IGFzIHByb2Nlc3NlZDogJHtzdHJpcGVFdmVudElkfWApO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIG1hcmtpbmcgZXZlbnQgYXMgcHJvY2Vzc2VkOicsIGVycm9yKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpc0V2ZW50UHJvY2Vzc2VkKHN0cmlwZUV2ZW50SWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zb2xlLmxvZyhgQ2hlY2tpbmcgaWYgZXZlbnQgaXMgcHJvY2Vzc2VkOiAke3N0cmlwZUV2ZW50SWR9YCk7XHJcbiAgICBcclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3N0cmlwZV9ldmVudHMnKVxyXG4gICAgICAuc2VsZWN0KCdwcm9jZXNzZWQnKVxyXG4gICAgICAuZXEoJ3N0cmlwZV9ldmVudF9pZCcsIHN0cmlwZUV2ZW50SWQpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgLy8gSWYgZXZlbnQgbm90IGZvdW5kLCBpdCBoYXNuJ3QgYmVlbiBwcm9jZXNzZWRcclxuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdQR1JTVDExNicpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgRXZlbnQgJHtzdHJpcGVFdmVudElkfSBub3QgZm91bmQgaW4gZGF0YWJhc2VgKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY2hlY2tpbmcgaWYgZXZlbnQgaXMgcHJvY2Vzc2VkOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGlzUHJvY2Vzc2VkID0gZGF0YT8ucHJvY2Vzc2VkID09PSB0cnVlO1xyXG4gICAgY29uc29sZS5sb2coYEV2ZW50ICR7c3RyaXBlRXZlbnRJZH0gcHJvY2Vzc2VkIHN0YXR1czogJHtpc1Byb2Nlc3NlZH1gKTtcclxuICAgIHJldHVybiBpc1Byb2Nlc3NlZDtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY2hlY2tpbmcgaWYgZXZlbnQgaXMgcHJvY2Vzc2VkOicsIGVycm9yKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbi8vIFVzZXIgTWFuYWdlbWVudCBGdW5jdGlvbnNcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFVzZXJTdWJzY3JpcHRpb25TdGF0dXMoZW1haWw6IHN0cmluZyk6IFByb21pc2U8VXNlclN1YnNjcmlwdGlvblN0YXR1cyB8IG51bGw+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pbi5ycGMoJ2dldF91c2VyX3N1YnNjcmlwdGlvbl9zdGF0dXMnLCB7XHJcbiAgICAgIHVzZXJfZW1haWw6IGVtYWlsXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyB1c2VyIHN1YnNjcmlwdGlvbiBzdGF0dXM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZGF0YT8uWzBdIHx8IG51bGw7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNhbGxpbmcgZ2V0X3VzZXJfc3Vic2NyaXB0aW9uX3N0YXR1czonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cHNlcnRVc2VyKGVtYWlsOiBzdHJpbmcsIHN0cmlwZUN1c3RvbWVySWQ/OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pbi5ycGMoJ3Vwc2VydF91c2VyJywge1xyXG4gICAgICB1c2VyX2VtYWlsOiBlbWFpbCxcclxuICAgICAgc3RyaXBlX2N1c3RvbWVyX2lkOiBzdHJpcGVDdXN0b21lcklkXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBzZXJ0aW5nIHVzZXI6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY2FsbGluZyB1cHNlcnRfdXNlcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdGFydFRyaWFsKGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pbi5ycGMoJ3N0YXJ0X3RyaWFsJywge1xyXG4gICAgICB1c2VyX2VtYWlsOiBlbWFpbFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHN0YXJ0aW5nIHRyaWFsOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBkYXRhID09PSB0cnVlO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjYWxsaW5nIHN0YXJ0X3RyaWFsOicsIGVycm9yKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVc2VyQnlFbWFpbChlbWFpbDogc3RyaW5nKTogUHJvbWlzZTxVc2VyIHwgbnVsbD4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd1c2VycycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyB1c2VyIGJ5IGVtYWlsOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgdXNlciBieSBlbWFpbDonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVc2VyQnlTdHJpcGVDdXN0b21lcklkKGN1c3RvbWVySWQ6IHN0cmluZyk6IFByb21pc2U8VXNlciB8IG51bGw+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgndXNlcnMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdzdHJpcGVfY3VzdG9tZXJfaWQnLCBjdXN0b21lcklkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgdXNlciBieSBzdHJpcGUgY3VzdG9tZXIgSUQ6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyB1c2VyIGJ5IHN0cmlwZSBjdXN0b21lciBJRDonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbi8vIFN1YnNjcmlwdGlvbiBNYW5hZ2VtZW50IEZ1bmN0aW9uc1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlU3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbjogT21pdDxTdWJzY3JpcHRpb24sICdpZCcgfCAnY3JlYXRlZF9hdCcgfCAndXBkYXRlZF9hdCc+KTogUHJvbWlzZTxTdWJzY3JpcHRpb24gfCBudWxsPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnNvbGUubG9nKCdDcmVhdGluZyBzdWJzY3JpcHRpb246Jywgc3Vic2NyaXB0aW9uKTtcclxuICAgIFxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnc3Vic2NyaXB0aW9ucycpXHJcbiAgICAgIC5pbnNlcnQoc3Vic2NyaXB0aW9uKVxyXG4gICAgICAuc2VsZWN0KClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBzdWJzY3JpcHRpb246JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZygnU3VjY2Vzc2Z1bGx5IGNyZWF0ZWQgc3Vic2NyaXB0aW9uOicsIGRhdGEuaWQpO1xyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHN1YnNjcmlwdGlvbjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVTdWJzY3JpcHRpb24oXHJcbiAgc3RyaXBlU3Vic2NyaXB0aW9uSWQ6IHN0cmluZywgXHJcbiAgdXBkYXRlczogUGFydGlhbDxTdWJzY3JpcHRpb24+XHJcbik6IFByb21pc2U8U3Vic2NyaXB0aW9uIHwgbnVsbD4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zb2xlLmxvZyhgVXBkYXRpbmcgc3Vic2NyaXB0aW9uOiAke3N0cmlwZVN1YnNjcmlwdGlvbklkfWAsIHVwZGF0ZXMpO1xyXG4gICAgXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzdWJzY3JpcHRpb25zJylcclxuICAgICAgLnVwZGF0ZSh1cGRhdGVzKVxyXG4gICAgICAuZXEoJ3N0cmlwZV9zdWJzY3JpcHRpb25faWQnLCBzdHJpcGVTdWJzY3JpcHRpb25JZClcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgc3Vic2NyaXB0aW9uOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coJ1N1Y2Nlc3NmdWxseSB1cGRhdGVkIHN1YnNjcmlwdGlvbjonLCBkYXRhLmlkKTtcclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBzdWJzY3JpcHRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U3Vic2NyaXB0aW9uQnlTdHJpcGVJZChzdHJpcGVTdWJzY3JpcHRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxTdWJzY3JpcHRpb24gfCBudWxsPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3N1YnNjcmlwdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdzdHJpcGVfc3Vic2NyaXB0aW9uX2lkJywgc3RyaXBlU3Vic2NyaXB0aW9uSWQpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyBzdWJzY3JpcHRpb24gYnkgU3RyaXBlIElEOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgc3Vic2NyaXB0aW9uIGJ5IFN0cmlwZSBJRDonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbi8vIFBheW1lbnQgTWFuYWdlbWVudCBGdW5jdGlvbnNcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVBheW1lbnQocGF5bWVudDogT21pdDxQYXltZW50LCAnaWQnIHwgJ2NyZWF0ZWRfYXQnPik6IFByb21pc2U8UGF5bWVudCB8IG51bGw+IHtcclxuICB0cnkge1xyXG4gICAgY29uc29sZS5sb2coJ0NyZWF0aW5nIHBheW1lbnQgcmVjb3JkOicsIHBheW1lbnQuc3RyaXBlX3BheW1lbnRfaW50ZW50X2lkKTtcclxuICAgIFxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgncGF5bWVudHMnKVxyXG4gICAgICAuaW5zZXJ0KHBheW1lbnQpXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHBheW1lbnQgcmVjb3JkOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coJ1N1Y2Nlc3NmdWxseSBjcmVhdGVkIHBheW1lbnQgcmVjb3JkOicsIGRhdGEuaWQpO1xyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHBheW1lbnQgcmVjb3JkOicsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVBheW1lbnQoXHJcbiAgcGF5bWVudEludGVudElkOiBzdHJpbmcsXHJcbiAgdXBkYXRlczogUGFydGlhbDxQYXltZW50PlxyXG4pOiBQcm9taXNlPFBheW1lbnQgfCBudWxsPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3BheW1lbnRzJylcclxuICAgICAgLnVwZGF0ZSh1cGRhdGVzKVxyXG4gICAgICAuZXEoJ3N0cmlwZV9wYXltZW50X2ludGVudF9pZCcsIHBheW1lbnRJbnRlbnRJZClcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcGF5bWVudDonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBwYXltZW50OicsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufSJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdXBhYmFzZVNlcnZpY2VLZXkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwic3VwYWJhc2VBbm9uS2V5IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJzdXBhYmFzZUFkbWluIiwiYXV0aCIsImF1dG9SZWZyZXNoVG9rZW4iLCJwZXJzaXN0U2Vzc2lvbiIsInN1cGFiYXNlIiwicmVjb3JkU3RyaXBlRXZlbnQiLCJzdHJpcGVFdmVudElkIiwiZXZlbnRUeXBlIiwiZGF0YSIsImFwaVZlcnNpb24iLCJjb25zb2xlIiwibG9nIiwicmVzdWx0IiwiZXJyb3IiLCJmcm9tIiwiaW5zZXJ0Iiwic3RyaXBlX2V2ZW50X2lkIiwiZXZlbnRfdHlwZSIsImFwaV92ZXJzaW9uIiwicHJvY2Vzc2VkIiwic2VsZWN0Iiwic2luZ2xlIiwiY29kZSIsIm1hcmtFdmVudFByb2Nlc3NlZCIsInVwZGF0ZSIsInByb2Nlc3NlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImVxIiwiaXNFdmVudFByb2Nlc3NlZCIsImlzUHJvY2Vzc2VkIiwiZ2V0VXNlclN1YnNjcmlwdGlvblN0YXR1cyIsImVtYWlsIiwicnBjIiwidXNlcl9lbWFpbCIsInVwc2VydFVzZXIiLCJzdHJpcGVDdXN0b21lcklkIiwic3RyaXBlX2N1c3RvbWVyX2lkIiwic3RhcnRUcmlhbCIsImdldFVzZXJCeUVtYWlsIiwiZ2V0VXNlckJ5U3RyaXBlQ3VzdG9tZXJJZCIsImN1c3RvbWVySWQiLCJjcmVhdGVTdWJzY3JpcHRpb24iLCJzdWJzY3JpcHRpb24iLCJpZCIsInVwZGF0ZVN1YnNjcmlwdGlvbiIsInN0cmlwZVN1YnNjcmlwdGlvbklkIiwidXBkYXRlcyIsImdldFN1YnNjcmlwdGlvbkJ5U3RyaXBlSWQiLCJjcmVhdGVQYXltZW50IiwicGF5bWVudCIsInN0cmlwZV9wYXltZW50X2ludGVudF9pZCIsInVwZGF0ZVBheW1lbnQiLCJwYXltZW50SW50ZW50SWQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/supabase.ts\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fstripe%2Fwebhook&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cstripe%5Cwebhook.ts&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fstripe%2Fwebhook&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cstripe%5Cwebhook.ts&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   handler: () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/api-utils */ \"(api-node)/./node_modules/next/dist/server/api-utils/index.js\");\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_stripe_webhook_ts__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./pages\\api\\stripe\\webhook.ts */ \"(api-node)/./pages/api/stripe/webhook.ts\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(api-node)/./node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(api-node)/./node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_stripe_webhook_ts__WEBPACK_IMPORTED_MODULE_4__]);\n_pages_api_stripe_webhook_ts__WEBPACK_IMPORTED_MODULE_4__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n// Import the userland code.\n\n\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_pages_api_stripe_webhook_ts__WEBPACK_IMPORTED_MODULE_4__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_pages_api_stripe_webhook_ts__WEBPACK_IMPORTED_MODULE_4__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/stripe/webhook\",\n        pathname: \"/api/stripe/webhook\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_stripe_webhook_ts__WEBPACK_IMPORTED_MODULE_4__,\n    distDir: \".next\" || 0,\n    relativeProjectDir:  false || ''\n});\nasync function handler(req, res, ctx) {\n    let srcPage = \"/api/stripe/webhook\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {}\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return;\n    }\n    const { query, params, prerenderManifest, routerServerContext } = prepareResult;\n    try {\n        const method = req.method || 'GET';\n        const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.getTracer)();\n        const activeSpan = tracer.getActiveScopeSpan();\n        const onRequestError = routeModule.instrumentationOnRequestError.bind(routeModule);\n        const invokeRouteModule = async (span)=>routeModule.render(req, res, {\n                query: {\n                    ...query,\n                    ...params\n                },\n                params,\n                allowedRevalidateHeaderKeys: [],\n                multiZoneDraftMode: Boolean(false),\n                trustHostHeader: false,\n                // TODO: get this from from runtime env so manifest\n                // doesn't need to load\n                previewProps: prerenderManifest.preview,\n                propagateError: false,\n                dev: routeModule.isDev,\n                page: \"/api/stripe/webhook\",\n                internalRevalidate: routerServerContext == null ? void 0 : routerServerContext.revalidate,\n                onError: (...args)=>onRequestError(req, ...args)\n            }).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await invokeRouteModule(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, invokeRouteModule));\n        }\n    } catch (err) {\n        // we re-throw in dev to show the error overlay\n        if (routeModule.isDev) {\n            throw err;\n        }\n        // this is technically an invariant as error handling\n        // should be done inside of api-resolver onError\n        (0,next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__.sendError)(res, 500, 'Internal Server Error');\n    } finally{\n        // We don't allow any waitUntil work in pages API routes currently\n        // so if callback is present return with resolved promise since no\n        // pending work\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n    }\n}\n\n//# sourceMappingURL=pages-api.js.map\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGc3RyaXBlJTJGd2ViaG9vayZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTVDYXBpJTVDc3RyaXBlJTVDd2ViaG9vay50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBdUQ7QUFDQztBQUN1QztBQUNyQztBQUMxRDtBQUM2RDtBQUNXO0FBQ0Y7QUFDdEU7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHlEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyx5REFBUTtBQUNwQztBQUNBLHdCQUF3Qix5R0FBbUI7QUFDM0M7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLGFBQWEsT0FBb0MsSUFBSSxDQUFFO0FBQ3ZELHdCQUF3QixNQUF1QztBQUMvRCxDQUFDO0FBQ007QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsS0FBcUIsRUFBRSxFQUUxQjtBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSx3REFBd0Q7QUFDcEU7QUFDQTtBQUNBLHVCQUF1Qiw0RUFBUztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSw2Q0FBNkMsRUFBNkM7QUFDMUYsNENBQTRDLEtBQXdDO0FBQ3BGLGlDQUFpQyxLQUFvQztBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFBaUUsZ0ZBQWM7QUFDL0UsK0RBQStELHlDQUF5QztBQUN4RztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxRQUFRLEVBQUUsTUFBTTtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLGtCQUFrQjtBQUNsQix1Q0FBdUMsUUFBUSxFQUFFLFFBQVE7QUFDekQ7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1YsNkVBQTZFLGdGQUFjO0FBQzNGLGlDQUFpQyxRQUFRLEVBQUUsUUFBUTtBQUNuRCwwQkFBMEIsdUVBQVE7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxxRUFBUztBQUNqQixNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2VuZEVycm9yIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvYXBpLXV0aWxzXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFxzdHJpcGVcXFxcd2ViaG9vay50c1wiO1xuaW1wb3J0IHsgZ2V0VHJhY2VyLCBTcGFuS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi90cmFjZS90cmFjZXJcIjtcbmltcG9ydCB7IEJhc2VTZXJ2ZXJTcGFuIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3RyYWNlL2NvbnN0YW50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCAnZGVmYXVsdCcpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgJ2NvbmZpZycpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9zdHJpcGUvd2ViaG9va1wiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3N0cmlwZS93ZWJob29rXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogJycsXG4gICAgICAgIGZpbGVuYW1lOiAnJ1xuICAgIH0sXG4gICAgdXNlcmxhbmQsXG4gICAgZGlzdERpcjogcHJvY2Vzcy5lbnYuX19ORVhUX1JFTEFUSVZFX0RJU1RfRElSIHx8ICcnLFxuICAgIHJlbGF0aXZlUHJvamVjdERpcjogcHJvY2Vzcy5lbnYuX19ORVhUX1JFTEFUSVZFX1BST0pFQ1RfRElSIHx8ICcnXG59KTtcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzLCBjdHgpIHtcbiAgICBsZXQgc3JjUGFnZSA9IFwiL2FwaS9zdHJpcGUvd2ViaG9va1wiO1xuICAgIC8vIHR1cmJvcGFjayBkb2Vzbid0IG5vcm1hbGl6ZSBgL2luZGV4YCBpbiB0aGUgcGFnZSBuYW1lXG4gICAgLy8gc28gd2UgbmVlZCB0byB0byBwcm9jZXNzIGR5bmFtaWMgcm91dGVzIHByb3Blcmx5XG4gICAgLy8gVE9ETzogZml4IHR1cmJvcGFjayBwcm92aWRpbmcgZGlmZmVyaW5nIHZhbHVlIGZyb20gd2VicGFja1xuICAgIGlmIChwcm9jZXNzLmVudi5UVVJCT1BBQ0spIHtcbiAgICAgICAgc3JjUGFnZSA9IHNyY1BhZ2UucmVwbGFjZSgvXFwvaW5kZXgkLywgJycpIHx8ICcvJztcbiAgICB9XG4gICAgY29uc3QgcHJlcGFyZVJlc3VsdCA9IGF3YWl0IHJvdXRlTW9kdWxlLnByZXBhcmUocmVxLCByZXMsIHtcbiAgICAgICAgc3JjUGFnZVxuICAgIH0pO1xuICAgIGlmICghcHJlcGFyZVJlc3VsdCkge1xuICAgICAgICByZXMuc3RhdHVzQ29kZSA9IDQwMDtcbiAgICAgICAgcmVzLmVuZCgnQmFkIFJlcXVlc3QnKTtcbiAgICAgICAgY3R4LndhaXRVbnRpbCA9PSBudWxsID8gdm9pZCAwIDogY3R4LndhaXRVbnRpbC5jYWxsKGN0eCwgUHJvbWlzZS5yZXNvbHZlKCkpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHsgcXVlcnksIHBhcmFtcywgcHJlcmVuZGVyTWFuaWZlc3QsIHJvdXRlclNlcnZlckNvbnRleHQgfSA9IHByZXBhcmVSZXN1bHQ7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbWV0aG9kID0gcmVxLm1ldGhvZCB8fCAnR0VUJztcbiAgICAgICAgY29uc3QgdHJhY2VyID0gZ2V0VHJhY2VyKCk7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVNwYW4gPSB0cmFjZXIuZ2V0QWN0aXZlU2NvcGVTcGFuKCk7XG4gICAgICAgIGNvbnN0IG9uUmVxdWVzdEVycm9yID0gcm91dGVNb2R1bGUuaW5zdHJ1bWVudGF0aW9uT25SZXF1ZXN0RXJyb3IuYmluZChyb3V0ZU1vZHVsZSk7XG4gICAgICAgIGNvbnN0IGludm9rZVJvdXRlTW9kdWxlID0gYXN5bmMgKHNwYW4pPT5yb3V0ZU1vZHVsZS5yZW5kZXIocmVxLCByZXMsIHtcbiAgICAgICAgICAgICAgICBxdWVyeToge1xuICAgICAgICAgICAgICAgICAgICAuLi5xdWVyeSxcbiAgICAgICAgICAgICAgICAgICAgLi4ucGFyYW1zXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICAgICAgYWxsb3dlZFJldmFsaWRhdGVIZWFkZXJLZXlzOiBwcm9jZXNzLmVudi5fX05FWFRfQUxMT1dFRF9SRVZBTElEQVRFX0hFQURFUlMsXG4gICAgICAgICAgICAgICAgbXVsdGlab25lRHJhZnRNb2RlOiBCb29sZWFuKHByb2Nlc3MuZW52Ll9fTkVYVF9NVUxUSV9aT05FX0RSQUZUX01PREUpLFxuICAgICAgICAgICAgICAgIHRydXN0SG9zdEhlYWRlcjogcHJvY2Vzcy5lbnYuX19ORVhUX1RSVVNUX0hPU1RfSEVBREVSLFxuICAgICAgICAgICAgICAgIC8vIFRPRE86IGdldCB0aGlzIGZyb20gZnJvbSBydW50aW1lIGVudiBzbyBtYW5pZmVzdFxuICAgICAgICAgICAgICAgIC8vIGRvZXNuJ3QgbmVlZCB0byBsb2FkXG4gICAgICAgICAgICAgICAgcHJldmlld1Byb3BzOiBwcmVyZW5kZXJNYW5pZmVzdC5wcmV2aWV3LFxuICAgICAgICAgICAgICAgIHByb3BhZ2F0ZUVycm9yOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBkZXY6IHJvdXRlTW9kdWxlLmlzRGV2LFxuICAgICAgICAgICAgICAgIHBhZ2U6IFwiL2FwaS9zdHJpcGUvd2ViaG9va1wiLFxuICAgICAgICAgICAgICAgIGludGVybmFsUmV2YWxpZGF0ZTogcm91dGVyU2VydmVyQ29udGV4dCA9PSBudWxsID8gdm9pZCAwIDogcm91dGVyU2VydmVyQ29udGV4dC5yZXZhbGlkYXRlLFxuICAgICAgICAgICAgICAgIG9uRXJyb3I6ICguLi5hcmdzKT0+b25SZXF1ZXN0RXJyb3IocmVxLCAuLi5hcmdzKVxuICAgICAgICAgICAgfSkuZmluYWxseSgoKT0+e1xuICAgICAgICAgICAgICAgIGlmICghc3BhbikgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHNwYW4uc2V0QXR0cmlidXRlcyh7XG4gICAgICAgICAgICAgICAgICAgICdodHRwLnN0YXR1c19jb2RlJzogcmVzLnN0YXR1c0NvZGUsXG4gICAgICAgICAgICAgICAgICAgICduZXh0LnJzYyc6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm9vdFNwYW5BdHRyaWJ1dGVzID0gdHJhY2VyLmdldFJvb3RTcGFuQXR0cmlidXRlcygpO1xuICAgICAgICAgICAgICAgIC8vIFdlIHdlcmUgdW5hYmxlIHRvIGdldCBhdHRyaWJ1dGVzLCBwcm9iYWJseSBPVEVMIGlzIG5vdCBlbmFibGVkXG4gICAgICAgICAgICAgICAgaWYgKCFyb290U3BhbkF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5zcGFuX3R5cGUnKSAhPT0gQmFzZVNlcnZlclNwYW4uaGFuZGxlUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFVuZXhwZWN0ZWQgcm9vdCBzcGFuIHR5cGUgJyR7cm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5zcGFuX3R5cGUnKX0nLiBQbGVhc2UgcmVwb3J0IHRoaXMgTmV4dC5qcyBpc3N1ZSBodHRwczovL2dpdGh1Yi5jb20vdmVyY2VsL25leHQuanNgKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCByb3V0ZSA9IHJvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQucm91dGUnKTtcbiAgICAgICAgICAgICAgICBpZiAocm91dGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGAke21ldGhvZH0gJHtyb3V0ZX1gO1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZXMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgJ25leHQucm91dGUnOiByb3V0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLnJvdXRlJzogcm91dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnbmV4dC5zcGFuX25hbWUnOiBuYW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnVwZGF0ZU5hbWUobmFtZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi51cGRhdGVOYW1lKGAke21ldGhvZH0gJHtyZXEudXJsfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAvLyBUT0RPOiBhY3RpdmVTcGFuIGNvZGUgcGF0aCBpcyBmb3Igd2hlbiB3cmFwcGVkIGJ5XG4gICAgICAgIC8vIG5leHQtc2VydmVyIGNhbiBiZSByZW1vdmVkIHdoZW4gdGhpcyBpcyBubyBsb25nZXIgdXNlZFxuICAgICAgICBpZiAoYWN0aXZlU3Bhbikge1xuICAgICAgICAgICAgYXdhaXQgaW52b2tlUm91dGVNb2R1bGUoYWN0aXZlU3Bhbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhd2FpdCB0cmFjZXIud2l0aFByb3BhZ2F0ZWRDb250ZXh0KHJlcS5oZWFkZXJzLCAoKT0+dHJhY2VyLnRyYWNlKEJhc2VTZXJ2ZXJTcGFuLmhhbmRsZVJlcXVlc3QsIHtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbk5hbWU6IGAke21ldGhvZH0gJHtyZXEudXJsfWAsXG4gICAgICAgICAgICAgICAgICAgIGtpbmQ6IFNwYW5LaW5kLlNFUlZFUixcbiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ2h0dHAubWV0aG9kJzogbWV0aG9kLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2h0dHAudGFyZ2V0JzogcmVxLnVybFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgaW52b2tlUm91dGVNb2R1bGUpKTtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAvLyB3ZSByZS10aHJvdyBpbiBkZXYgdG8gc2hvdyB0aGUgZXJyb3Igb3ZlcmxheVxuICAgICAgICBpZiAocm91dGVNb2R1bGUuaXNEZXYpIHtcbiAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfVxuICAgICAgICAvLyB0aGlzIGlzIHRlY2huaWNhbGx5IGFuIGludmFyaWFudCBhcyBlcnJvciBoYW5kbGluZ1xuICAgICAgICAvLyBzaG91bGQgYmUgZG9uZSBpbnNpZGUgb2YgYXBpLXJlc29sdmVyIG9uRXJyb3JcbiAgICAgICAgc2VuZEVycm9yKHJlcywgNTAwLCAnSW50ZXJuYWwgU2VydmVyIEVycm9yJyk7XG4gICAgfSBmaW5hbGx5e1xuICAgICAgICAvLyBXZSBkb24ndCBhbGxvdyBhbnkgd2FpdFVudGlsIHdvcmsgaW4gcGFnZXMgQVBJIHJvdXRlcyBjdXJyZW50bHlcbiAgICAgICAgLy8gc28gaWYgY2FsbGJhY2sgaXMgcHJlc2VudCByZXR1cm4gd2l0aCByZXNvbHZlZCBwcm9taXNlIHNpbmNlIG5vXG4gICAgICAgIC8vIHBlbmRpbmcgd29ya1xuICAgICAgICBjdHgud2FpdFVudGlsID09IG51bGwgPyB2b2lkIDAgOiBjdHgud2FpdFVudGlsLmNhbGwoY3R4LCBQcm9taXNlLnJlc29sdmUoKSk7XG4gICAgfVxufVxuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwXG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fstripe%2Fwebhook&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cstripe%5Cwebhook.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/stripe/webhook.ts":
/*!*************************************!*\
  !*** ./pages/api/stripe/webhook.ts ***!
  \*************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_stripe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/stripe */ \"(api-node)/./lib/stripe.ts\");\n/* harmony import */ var _lib_supabase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/supabase */ \"(api-node)/./lib/supabase.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_stripe__WEBPACK_IMPORTED_MODULE_0__]);\n_lib_stripe__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// pages/api/stripe/webhook.ts\n\n\n// Disable body parsing for webhook\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\n// Helper to read raw body\nasync function getRawBody(req) {\n    const chunks = [];\n    return new Promise((resolve, reject)=>{\n        req.on('data', (chunk)=>{\n            chunks.push(chunk);\n        });\n        req.on('end', ()=>{\n            resolve(Buffer.concat(chunks));\n        });\n        req.on('error', (error)=>{\n            reject(error);\n        });\n    });\n}\nasync function handler(req, res) {\n    if (req.method !== 'POST') {\n        return res.status(405).json({\n            error: 'Method not allowed'\n        });\n    }\n    const webhookSecret = process.env.STRIPE_WEBHOOK_SECRET;\n    if (!webhookSecret) {\n        console.error('STRIPE_WEBHOOK_SECRET is not set');\n        return res.status(500).json({\n            error: 'Webhook secret not configured'\n        });\n    }\n    try {\n        const rawBody = await getRawBody(req);\n        const signature = req.headers['stripe-signature'];\n        if (!signature) {\n            return res.status(400).json({\n                error: 'No signature provided'\n            });\n        }\n        // Construct the webhook event\n        const event = (0,_lib_stripe__WEBPACK_IMPORTED_MODULE_0__.constructWebhookEvent)(rawBody, signature, webhookSecret);\n        if (!event) {\n            return res.status(400).json({\n                error: 'Invalid signature'\n            });\n        }\n        console.log(`Received Stripe webhook: ${event.type} (${event.id})`);\n        // Check if event already processed (idempotency)\n        const isAlreadyProcessed = await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.isEventProcessed)(event.id);\n        if (isAlreadyProcessed) {\n            console.log(`Event ${event.id} already processed, skipping`);\n            return res.status(200).json({\n                received: true,\n                skipped: true\n            });\n        }\n        // Record the event\n        const shouldProcess = await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.recordStripeEvent)(event.id, event.type, event.data.object, event.api_version || undefined);\n        if (!shouldProcess) {\n            console.log(`Event ${event.id} already being processed`);\n            return res.status(200).json({\n                received: true,\n                duplicate: true\n            });\n        }\n        // Process the event\n        let processed = false;\n        try {\n            switch(event.type){\n                case 'checkout.session.completed':\n                    await handleCheckoutSessionCompleted(event.data.object);\n                    processed = true;\n                    break;\n                case 'customer.subscription.created':\n                    await handleSubscriptionCreated(event.data.object);\n                    processed = true;\n                    break;\n                case 'customer.subscription.updated':\n                    await handleSubscriptionUpdated(event.data.object);\n                    processed = true;\n                    break;\n                case 'customer.subscription.deleted':\n                    await handleSubscriptionDeleted(event.data.object);\n                    processed = true;\n                    break;\n                case 'invoice.payment_succeeded':\n                    await handlePaymentSucceeded(event.data.object);\n                    processed = true;\n                    break;\n                case 'invoice.payment_failed':\n                    await handlePaymentFailed(event.data.object);\n                    processed = true;\n                    break;\n                case 'payment_intent.succeeded':\n                    await handlePaymentIntentSucceeded(event.data.object);\n                    processed = true;\n                    break;\n                default:\n                    console.log(`Unhandled event type: ${event.type}`);\n                    processed = true; // Mark as processed even if unhandled\n                    break;\n            }\n        } catch (error) {\n            console.error(`Error processing webhook event ${event.id}:`, error);\n            // Don't mark as processed if there was an error\n            return res.status(500).json({\n                error: 'Event processing failed'\n            });\n        }\n        // Mark event as processed\n        if (processed) {\n            await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.markEventProcessed)(event.id);\n            console.log(`Event ${event.id} successfully processed and marked complete`);\n        }\n        res.status(200).json({\n            received: true,\n            processed: true\n        });\n    } catch (error) {\n        console.error('Webhook handler error:', error);\n        res.status(400).json({\n            error: 'Webhook processing failed'\n        });\n    }\n}\nasync function handleCheckoutSessionCompleted(session) {\n    console.log(`Checkout session completed: ${session.id}`);\n    try {\n        const customerId = session.customer;\n        const user = await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.getUserByStripeCustomerId)(customerId);\n        if (!user) {\n            console.error(`User not found for customer: ${customerId}`);\n            return;\n        }\n        // Handle subscription checkout\n        if (session.mode === 'subscription' && session.subscription) {\n            console.log(`Subscription created via checkout: ${session.subscription}`);\n        // Subscription will be handled by customer.subscription.created\n        }\n        // Handle one-time payment (lifetime plan)\n        if (session.mode === 'payment') {\n            const lineItems = session.line_items?.data?.[0];\n            if (lineItems?.price?.id) {\n                const planType = (0,_lib_stripe__WEBPACK_IMPORTED_MODULE_0__.getPlanTypeFromPriceId)(lineItems.price.id);\n                if (planType === 'lifetime') {\n                    await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.createSubscription)({\n                        user_id: user.id,\n                        stripe_price_id: lineItems.price.id,\n                        status: 'active',\n                        plan_type: 'lifetime',\n                        current_period_start: new Date().toISOString(),\n                        current_period_end: new Date(Date.now() + 50 * 365 * 24 * 60 * 60 * 1000).toISOString(),\n                        cancel_at_period_end: false,\n                        metadata: {\n                            stripe_checkout_session_id: session.id\n                        }\n                    });\n                    console.log(`Lifetime subscription created for user: ${user.email}`);\n                }\n            }\n        }\n    } catch (error) {\n        console.error('Error handling checkout session completed:', error);\n        throw error;\n    }\n}\nasync function handleSubscriptionCreated(subscription) {\n    console.log(`Subscription created: ${subscription.id}`);\n    try {\n        const customerId = subscription.customer;\n        const user = await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.getUserByStripeCustomerId)(customerId);\n        if (!user) {\n            console.error(`User not found for customer: ${customerId}`);\n            return;\n        }\n        const priceId = subscription.items.data[0]?.price?.id;\n        if (!priceId) {\n            console.error(`No price ID found for subscription: ${subscription.id}`);\n            return;\n        }\n        const planType = (0,_lib_stripe__WEBPACK_IMPORTED_MODULE_0__.getPlanTypeFromPriceId)(priceId);\n        if (!planType) {\n            console.error(`Unknown price ID: ${priceId}`);\n            return;\n        }\n        await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.createSubscription)({\n            user_id: user.id,\n            stripe_subscription_id: subscription.id,\n            stripe_price_id: priceId,\n            status: subscription.status,\n            plan_type: planType,\n            current_period_start: new Date(subscription.current_period_start * 1000).toISOString(),\n            current_period_end: new Date(subscription.current_period_end * 1000).toISOString(),\n            cancel_at_period_end: subscription.cancel_at_period_end,\n            metadata: {\n                stripe_subscription_id: subscription.id\n            }\n        });\n        console.log(`Subscription record created for user: ${user.email}, plan: ${planType}`);\n    } catch (error) {\n        console.error('Error handling subscription created:', error);\n        throw error;\n    }\n}\nasync function handleSubscriptionUpdated(subscription) {\n    console.log(`Subscription updated: ${subscription.id}`);\n    try {\n        const updateData = {\n            status: subscription.status,\n            current_period_start: new Date(subscription.current_period_start * 1000).toISOString(),\n            current_period_end: new Date(subscription.current_period_end * 1000).toISOString(),\n            cancel_at_period_end: subscription.cancel_at_period_end\n        };\n        if (subscription.canceled_at) {\n            updateData.canceled_at = new Date(subscription.canceled_at * 1000).toISOString();\n        }\n        await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.updateSubscription)(subscription.id, updateData);\n        console.log(`Subscription updated in database: ${subscription.id}`);\n    } catch (error) {\n        console.error('Error handling subscription updated:', error);\n        throw error;\n    }\n}\nasync function handleSubscriptionDeleted(subscription) {\n    console.log(`Subscription deleted: ${subscription.id}`);\n    try {\n        await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.updateSubscription)(subscription.id, {\n            status: 'canceled',\n            canceled_at: new Date().toISOString()\n        });\n        console.log(`Subscription marked as canceled in database: ${subscription.id}`);\n    } catch (error) {\n        console.error('Error handling subscription deleted:', error);\n        throw error;\n    }\n}\nasync function handlePaymentSucceeded(invoice) {\n    console.log(`Payment succeeded: ${invoice.id}`);\n    try {\n        const customerId = invoice.customer;\n        const user = await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.getUserByStripeCustomerId)(customerId);\n        if (!user) {\n            console.error(`User not found for customer: ${customerId}`);\n            return;\n        }\n        if (invoice.payment_intent) {\n            await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.createPayment)({\n                user_id: user.id,\n                stripe_payment_intent_id: invoice.payment_intent,\n                amount: invoice.amount_paid,\n                currency: invoice.currency,\n                status: 'succeeded',\n                metadata: {\n                    invoice_id: invoice.id,\n                    subscription_id: invoice.subscription || null\n                }\n            });\n        }\n        console.log(`Payment record created for user: ${user.email}`);\n    } catch (error) {\n        console.error('Error handling payment succeeded:', error);\n        throw error;\n    }\n}\nasync function handlePaymentFailed(invoice) {\n    console.log(`Payment failed: ${invoice.id}`);\n    try {\n        const customerId = invoice.customer;\n        if (!customerId) {\n            console.log(`No customer ID in invoice ${invoice.id} - likely a test event`);\n            return;\n        }\n        const user = await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.getUserByStripeCustomerId)(customerId);\n        if (!user) {\n            console.log(`User not found for customer: ${customerId} - may be a test customer`);\n            return;\n        }\n        if (invoice.payment_intent) {\n            await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.createPayment)({\n                user_id: user.id,\n                stripe_payment_intent_id: invoice.payment_intent,\n                amount: invoice.amount_due,\n                currency: invoice.currency,\n                status: 'failed',\n                metadata: {\n                    invoice_id: invoice.id,\n                    subscription_id: invoice.subscription || null,\n                    failure_reason: 'Payment failed'\n                }\n            });\n        }\n        console.log(`Failed payment record created for user: ${user.email}`);\n    } catch (error) {\n        console.error('Error handling payment failed:', error);\n        throw error;\n    }\n}\nasync function handlePaymentIntentSucceeded(paymentIntent) {\n    console.log(`Payment intent succeeded: ${paymentIntent.id}`);\n    try {\n        const customerId = paymentIntent.customer;\n        if (!customerId) return;\n        const user = await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.getUserByStripeCustomerId)(customerId);\n        if (!user) {\n            console.error(`User not found for customer: ${customerId}`);\n            return;\n        }\n        await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.createPayment)({\n            user_id: user.id,\n            stripe_payment_intent_id: paymentIntent.id,\n            amount: paymentIntent.amount,\n            currency: paymentIntent.currency,\n            status: 'succeeded',\n            metadata: {\n                payment_method: paymentIntent.payment_method || null\n            }\n        });\n        console.log(`Payment intent record created for user: ${user.email}`);\n    } catch (error) {\n        console.error('Error handling payment intent succeeded:', error);\n        throw error;\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3BhZ2VzL2FwaS9zdHJpcGUvd2ViaG9vay50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUEsOEJBQThCO0FBRXNEO0FBU3JEO0FBRy9CLG1DQUFtQztBQUM1QixNQUFNUyxTQUFTO0lBQ3BCQyxLQUFLO1FBQ0hDLFlBQVk7SUFDZDtBQUNGLEVBQUU7QUFFRiwwQkFBMEI7QUFDMUIsZUFBZUMsV0FBV0MsR0FBbUI7SUFDM0MsTUFBTUMsU0FBbUIsRUFBRTtJQUUzQixPQUFPLElBQUlDLFFBQVEsQ0FBQ0MsU0FBU0M7UUFDM0JKLElBQUlLLEVBQUUsQ0FBQyxRQUFRLENBQUNDO1lBQ2RMLE9BQU9NLElBQUksQ0FBQ0Q7UUFDZDtRQUVBTixJQUFJSyxFQUFFLENBQUMsT0FBTztZQUNaRixRQUFRSyxPQUFPQyxNQUFNLENBQUNSO1FBQ3hCO1FBRUFELElBQUlLLEVBQUUsQ0FBQyxTQUFTLENBQUNLO1lBQ2ZOLE9BQU9NO1FBQ1Q7SUFDRjtBQUNGO0FBRWUsZUFBZUMsUUFBUVgsR0FBbUIsRUFBRVksR0FBb0I7SUFDN0UsSUFBSVosSUFBSWEsTUFBTSxLQUFLLFFBQVE7UUFDekIsT0FBT0QsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFTCxPQUFPO1FBQXFCO0lBQzVEO0lBRUEsTUFBTU0sZ0JBQWdCQyxRQUFRQyxHQUFHLENBQUNDLHFCQUFxQjtJQUN2RCxJQUFJLENBQUNILGVBQWU7UUFDbEJJLFFBQVFWLEtBQUssQ0FBQztRQUNkLE9BQU9FLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUwsT0FBTztRQUFnQztJQUN2RTtJQUVBLElBQUk7UUFDRixNQUFNVyxVQUFVLE1BQU10QixXQUFXQztRQUNqQyxNQUFNc0IsWUFBWXRCLElBQUl1QixPQUFPLENBQUMsbUJBQW1CO1FBRWpELElBQUksQ0FBQ0QsV0FBVztZQUNkLE9BQU9WLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVMLE9B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O0FBQ0Y7QUFFQSxlQUFla0MsNkJBQTZCc0MsYUFBbUM7SUFDN0U5RCxRQUFRSyxHQUFHLENBQUMsQ0FBQywwQkFBMEIsRUFBRXlELGNBQWN2RCxFQUFFLEVBQUU7SUFFM0QsSUFBSTtRQUNGLE1BQU1tQixhQUFhb0MsY0FBY25DLFFBQVE7UUFDekMsSUFBSSxDQUFDRCxZQUFZO1FBRWpCLE1BQU1FLE9BQU8sTUFBTXpELHdFQUF5QkEsQ0FBQ3VEO1FBQzdDLElBQUksQ0FBQ0UsTUFBTTtZQUNUNUIsUUFBUVYsS0FBSyxDQUFDLENBQUMsNkJBQTZCLEVBQUVvQyxZQUFZO1lBQzFEO1FBQ0Y7UUFFQSxNQUFNdEQsNERBQWFBLENBQUM7WUFDbEIrRCxTQUFTUCxLQUFLckIsRUFBRTtZQUNoQitDLDBCQUEwQlEsY0FBY3ZELEVBQUU7WUFDMUNnRCxRQUFRTyxjQUFjUCxNQUFNO1lBQzVCRSxVQUFVSyxjQUFjTCxRQUFRO1lBQ2hDL0QsUUFBUTtZQUNSa0QsVUFBVTtnQkFDUm1CLGdCQUFnQkQsY0FBY0MsY0FBYyxJQUFjO1lBQzVEO1FBQ0Y7UUFFQS9ELFFBQVFLLEdBQUcsQ0FBQyxDQUFDLHdDQUF3QyxFQUFFdUIsS0FBS2tCLEtBQUssRUFBRTtJQUNyRSxFQUFFLE9BQU94RCxPQUFPO1FBQ2RVLFFBQVFWLEtBQUssQ0FBQyw0Q0FBNENBO1FBQzFELE1BQU1BO0lBQ1I7QUFDRiIsInNvdXJjZXMiOlsiQzpcXGFyLWJvb2stZm9sZGluZy1hc3Npc3RhbnRcXHBhZ2VzXFxhcGlcXHN0cmlwZVxcd2ViaG9vay50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwYWdlcy9hcGkvc3RyaXBlL3dlYmhvb2sudHNcclxuaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XHJcbmltcG9ydCB7IGNvbnN0cnVjdFdlYmhvb2tFdmVudCwgZ2V0UGxhblR5cGVGcm9tUHJpY2VJZCB9IGZyb20gJy4uLy4uLy4uL2xpYi9zdHJpcGUnO1xyXG5pbXBvcnQgeyBcclxuICBjcmVhdGVTdWJzY3JpcHRpb24sIFxyXG4gIHVwZGF0ZVN1YnNjcmlwdGlvbiwgXHJcbiAgZ2V0VXNlckJ5U3RyaXBlQ3VzdG9tZXJJZCwgXHJcbiAgY3JlYXRlUGF5bWVudCxcclxuICByZWNvcmRTdHJpcGVFdmVudCxcclxuICBtYXJrRXZlbnRQcm9jZXNzZWQsXHJcbiAgaXNFdmVudFByb2Nlc3NlZFxyXG59IGZyb20gJy4uLy4uLy4uL2xpYi9zdXBhYmFzZSc7XHJcbmltcG9ydCB0eXBlIFN0cmlwZSBmcm9tICdzdHJpcGUnO1xyXG5cclxuLy8gRGlzYWJsZSBib2R5IHBhcnNpbmcgZm9yIHdlYmhvb2tcclxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcclxuICBhcGk6IHtcclxuICAgIGJvZHlQYXJzZXI6IGZhbHNlLFxyXG4gIH0sXHJcbn07XHJcblxyXG4vLyBIZWxwZXIgdG8gcmVhZCByYXcgYm9keVxyXG5hc3luYyBmdW5jdGlvbiBnZXRSYXdCb2R5KHJlcTogTmV4dEFwaVJlcXVlc3QpOiBQcm9taXNlPEJ1ZmZlcj4ge1xyXG4gIGNvbnN0IGNodW5rczogQnVmZmVyW10gPSBbXTtcclxuICBcclxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgcmVxLm9uKCdkYXRhJywgKGNodW5rOiBCdWZmZXIpID0+IHtcclxuICAgICAgY2h1bmtzLnB1c2goY2h1bmspO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIHJlcS5vbignZW5kJywgKCkgPT4ge1xyXG4gICAgICByZXNvbHZlKEJ1ZmZlci5jb25jYXQoY2h1bmtzKSk7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgcmVxLm9uKCdlcnJvcicsIChlcnJvcikgPT4ge1xyXG4gICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcclxuICBpZiAocmVxLm1ldGhvZCAhPT0gJ1BPU1QnKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBlcnJvcjogJ01ldGhvZCBub3QgYWxsb3dlZCcgfSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB3ZWJob29rU2VjcmV0ID0gcHJvY2Vzcy5lbnYuU1RSSVBFX1dFQkhPT0tfU0VDUkVUO1xyXG4gIGlmICghd2ViaG9va1NlY3JldCkge1xyXG4gICAgY29uc29sZS5lcnJvcignU1RSSVBFX1dFQkhPT0tfU0VDUkVUIGlzIG5vdCBzZXQnKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnV2ViaG9vayBzZWNyZXQgbm90IGNvbmZpZ3VyZWQnIH0pO1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHJhd0JvZHkgPSBhd2FpdCBnZXRSYXdCb2R5KHJlcSk7XHJcbiAgICBjb25zdCBzaWduYXR1cmUgPSByZXEuaGVhZGVyc1snc3RyaXBlLXNpZ25hdHVyZSddIGFzIHN0cmluZztcclxuXHJcbiAgICBpZiAoIXNpZ25hdHVyZSkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ05vIHNpZ25hdHVyZSBwcm92aWRlZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ29uc3RydWN0IHRoZSB3ZWJob29rIGV2ZW50XHJcbiAgICBjb25zdCBldmVudCA9IGNvbnN0cnVjdFdlYmhvb2tFdmVudChyYXdCb2R5LCBzaWduYXR1cmUsIHdlYmhvb2tTZWNyZXQpO1xyXG4gICAgaWYgKCFldmVudCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgc2lnbmF0dXJlJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZyhgUmVjZWl2ZWQgU3RyaXBlIHdlYmhvb2s6ICR7ZXZlbnQudHlwZX0gKCR7ZXZlbnQuaWR9KWApO1xyXG5cclxuICAgIC8vIENoZWNrIGlmIGV2ZW50IGFscmVhZHkgcHJvY2Vzc2VkIChpZGVtcG90ZW5jeSlcclxuICAgIGNvbnN0IGlzQWxyZWFkeVByb2Nlc3NlZCA9IGF3YWl0IGlzRXZlbnRQcm9jZXNzZWQoZXZlbnQuaWQpO1xyXG4gICAgaWYgKGlzQWxyZWFkeVByb2Nlc3NlZCkge1xyXG4gICAgICBjb25zb2xlLmxvZyhgRXZlbnQgJHtldmVudC5pZH0gYWxyZWFkeSBwcm9jZXNzZWQsIHNraXBwaW5nYCk7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IHJlY2VpdmVkOiB0cnVlLCBza2lwcGVkOiB0cnVlIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFJlY29yZCB0aGUgZXZlbnRcclxuICAgIGNvbnN0IHNob3VsZFByb2Nlc3MgPSBhd2FpdCByZWNvcmRTdHJpcGVFdmVudChcclxuICAgICAgZXZlbnQuaWQsXHJcbiAgICAgIGV2ZW50LnR5cGUsXHJcbiAgICAgIGV2ZW50LmRhdGEub2JqZWN0IGFzIFJlY29yZDxzdHJpbmcsIGFueT4sXHJcbiAgICAgIGV2ZW50LmFwaV92ZXJzaW9uIHx8IHVuZGVmaW5lZFxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAoIXNob3VsZFByb2Nlc3MpIHtcclxuICAgICAgY29uc29sZS5sb2coYEV2ZW50ICR7ZXZlbnQuaWR9IGFscmVhZHkgYmVpbmcgcHJvY2Vzc2VkYCk7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IHJlY2VpdmVkOiB0cnVlLCBkdXBsaWNhdGU6IHRydWUgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUHJvY2VzcyB0aGUgZXZlbnRcclxuICAgIGxldCBwcm9jZXNzZWQgPSBmYWxzZTtcclxuICAgIHRyeSB7XHJcbiAgICAgIHN3aXRjaCAoZXZlbnQudHlwZSkge1xyXG4gICAgICAgIGNhc2UgJ2NoZWNrb3V0LnNlc3Npb24uY29tcGxldGVkJzpcclxuICAgICAgICAgIGF3YWl0IGhhbmRsZUNoZWNrb3V0U2Vzc2lvbkNvbXBsZXRlZChldmVudC5kYXRhLm9iamVjdCBhcyBTdHJpcGUuQ2hlY2tvdXQuU2Vzc2lvbik7XHJcbiAgICAgICAgICBwcm9jZXNzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgJ2N1c3RvbWVyLnN1YnNjcmlwdGlvbi5jcmVhdGVkJzpcclxuICAgICAgICAgIGF3YWl0IGhhbmRsZVN1YnNjcmlwdGlvbkNyZWF0ZWQoZXZlbnQuZGF0YS5vYmplY3QgYXMgU3RyaXBlLlN1YnNjcmlwdGlvbik7XHJcbiAgICAgICAgICBwcm9jZXNzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgJ2N1c3RvbWVyLnN1YnNjcmlwdGlvbi51cGRhdGVkJzpcclxuICAgICAgICAgIGF3YWl0IGhhbmRsZVN1YnNjcmlwdGlvblVwZGF0ZWQoZXZlbnQuZGF0YS5vYmplY3QgYXMgU3RyaXBlLlN1YnNjcmlwdGlvbik7XHJcbiAgICAgICAgICBwcm9jZXNzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgJ2N1c3RvbWVyLnN1YnNjcmlwdGlvbi5kZWxldGVkJzpcclxuICAgICAgICAgIGF3YWl0IGhhbmRsZVN1YnNjcmlwdGlvbkRlbGV0ZWQoZXZlbnQuZGF0YS5vYmplY3QgYXMgU3RyaXBlLlN1YnNjcmlwdGlvbik7XHJcbiAgICAgICAgICBwcm9jZXNzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgJ2ludm9pY2UucGF5bWVudF9zdWNjZWVkZWQnOlxyXG4gICAgICAgICAgYXdhaXQgaGFuZGxlUGF5bWVudFN1Y2NlZWRlZChldmVudC5kYXRhLm9iamVjdCBhcyBTdHJpcGUuSW52b2ljZSk7XHJcbiAgICAgICAgICBwcm9jZXNzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgJ2ludm9pY2UucGF5bWVudF9mYWlsZWQnOlxyXG4gICAgICAgICAgYXdhaXQgaGFuZGxlUGF5bWVudEZhaWxlZChldmVudC5kYXRhLm9iamVjdCBhcyBTdHJpcGUuSW52b2ljZSk7XHJcbiAgICAgICAgICBwcm9jZXNzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgJ3BheW1lbnRfaW50ZW50LnN1Y2NlZWRlZCc6XHJcbiAgICAgICAgICBhd2FpdCBoYW5kbGVQYXltZW50SW50ZW50U3VjY2VlZGVkKGV2ZW50LmRhdGEub2JqZWN0IGFzIFN0cmlwZS5QYXltZW50SW50ZW50KTtcclxuICAgICAgICAgIHByb2Nlc3NlZCA9IHRydWU7XHJcbiAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGBVbmhhbmRsZWQgZXZlbnQgdHlwZTogJHtldmVudC50eXBlfWApO1xyXG4gICAgICAgICAgcHJvY2Vzc2VkID0gdHJ1ZTsgLy8gTWFyayBhcyBwcm9jZXNzZWQgZXZlbiBpZiB1bmhhbmRsZWRcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBwcm9jZXNzaW5nIHdlYmhvb2sgZXZlbnQgJHtldmVudC5pZH06YCwgZXJyb3IpO1xyXG4gICAgICAvLyBEb24ndCBtYXJrIGFzIHByb2Nlc3NlZCBpZiB0aGVyZSB3YXMgYW4gZXJyb3JcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdFdmVudCBwcm9jZXNzaW5nIGZhaWxlZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTWFyayBldmVudCBhcyBwcm9jZXNzZWRcclxuICAgIGlmIChwcm9jZXNzZWQpIHtcclxuICAgICAgYXdhaXQgbWFya0V2ZW50UHJvY2Vzc2VkKGV2ZW50LmlkKTtcclxuICAgICAgY29uc29sZS5sb2coYEV2ZW50ICR7ZXZlbnQuaWR9IHN1Y2Nlc3NmdWxseSBwcm9jZXNzZWQgYW5kIG1hcmtlZCBjb21wbGV0ZWApO1xyXG4gICAgfVxyXG5cclxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgcmVjZWl2ZWQ6IHRydWUsIHByb2Nlc3NlZDogdHJ1ZSB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignV2ViaG9vayBoYW5kbGVyIGVycm9yOicsIGVycm9yKTtcclxuICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdXZWJob29rIHByb2Nlc3NpbmcgZmFpbGVkJyB9KTtcclxuICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUNoZWNrb3V0U2Vzc2lvbkNvbXBsZXRlZChzZXNzaW9uOiBTdHJpcGUuQ2hlY2tvdXQuU2Vzc2lvbikge1xyXG4gIGNvbnNvbGUubG9nKGBDaGVja291dCBzZXNzaW9uIGNvbXBsZXRlZDogJHtzZXNzaW9uLmlkfWApO1xyXG4gIFxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBjdXN0b21lcklkID0gc2Vzc2lvbi5jdXN0b21lciBhcyBzdHJpbmc7XHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgZ2V0VXNlckJ5U3RyaXBlQ3VzdG9tZXJJZChjdXN0b21lcklkKTtcclxuICAgIFxyXG4gICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFVzZXIgbm90IGZvdW5kIGZvciBjdXN0b21lcjogJHtjdXN0b21lcklkfWApO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSGFuZGxlIHN1YnNjcmlwdGlvbiBjaGVja291dFxyXG4gICAgaWYgKHNlc3Npb24ubW9kZSA9PT0gJ3N1YnNjcmlwdGlvbicgJiYgc2Vzc2lvbi5zdWJzY3JpcHRpb24pIHtcclxuICAgICAgY29uc29sZS5sb2coYFN1YnNjcmlwdGlvbiBjcmVhdGVkIHZpYSBjaGVja291dDogJHtzZXNzaW9uLnN1YnNjcmlwdGlvbn1gKTtcclxuICAgICAgLy8gU3Vic2NyaXB0aW9uIHdpbGwgYmUgaGFuZGxlZCBieSBjdXN0b21lci5zdWJzY3JpcHRpb24uY3JlYXRlZFxyXG4gICAgfVxyXG5cclxuICAgIC8vIEhhbmRsZSBvbmUtdGltZSBwYXltZW50IChsaWZldGltZSBwbGFuKVxyXG4gICAgaWYgKHNlc3Npb24ubW9kZSA9PT0gJ3BheW1lbnQnKSB7XHJcbiAgICAgIGNvbnN0IGxpbmVJdGVtcyA9IHNlc3Npb24ubGluZV9pdGVtcz8uZGF0YT8uWzBdO1xyXG4gICAgICBpZiAobGluZUl0ZW1zPy5wcmljZT8uaWQpIHtcclxuICAgICAgICBjb25zdCBwbGFuVHlwZSA9IGdldFBsYW5UeXBlRnJvbVByaWNlSWQobGluZUl0ZW1zLnByaWNlLmlkKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAocGxhblR5cGUgPT09ICdsaWZldGltZScpIHtcclxuICAgICAgICAgIGF3YWl0IGNyZWF0ZVN1YnNjcmlwdGlvbih7XHJcbiAgICAgICAgICAgIHVzZXJfaWQ6IHVzZXIuaWQsXHJcbiAgICAgICAgICAgIHN0cmlwZV9wcmljZV9pZDogbGluZUl0ZW1zLnByaWNlLmlkLFxyXG4gICAgICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLFxyXG4gICAgICAgICAgICBwbGFuX3R5cGU6ICdsaWZldGltZScsXHJcbiAgICAgICAgICAgIGN1cnJlbnRfcGVyaW9kX3N0YXJ0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICAgIGN1cnJlbnRfcGVyaW9kX2VuZDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDUwICogMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCkudG9JU09TdHJpbmcoKSwgLy8gNTAgeWVhcnNcclxuICAgICAgICAgICAgY2FuY2VsX2F0X3BlcmlvZF9lbmQ6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgICAgIHN0cmlwZV9jaGVja291dF9zZXNzaW9uX2lkOiBzZXNzaW9uLmlkXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhgTGlmZXRpbWUgc3Vic2NyaXB0aW9uIGNyZWF0ZWQgZm9yIHVzZXI6ICR7dXNlci5lbWFpbH1gKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaGFuZGxpbmcgY2hlY2tvdXQgc2Vzc2lvbiBjb21wbGV0ZWQ6JywgZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVTdWJzY3JpcHRpb25DcmVhdGVkKHN1YnNjcmlwdGlvbjogU3RyaXBlLlN1YnNjcmlwdGlvbikge1xyXG4gIGNvbnNvbGUubG9nKGBTdWJzY3JpcHRpb24gY3JlYXRlZDogJHtzdWJzY3JpcHRpb24uaWR9YCk7XHJcbiAgXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGN1c3RvbWVySWQgPSBzdWJzY3JpcHRpb24uY3VzdG9tZXIgYXMgc3RyaW5nO1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IGdldFVzZXJCeVN0cmlwZUN1c3RvbWVySWQoY3VzdG9tZXJJZCk7XHJcbiAgICBcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBVc2VyIG5vdCBmb3VuZCBmb3IgY3VzdG9tZXI6ICR7Y3VzdG9tZXJJZH1gKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHByaWNlSWQgPSBzdWJzY3JpcHRpb24uaXRlbXMuZGF0YVswXT8ucHJpY2U/LmlkO1xyXG4gICAgaWYgKCFwcmljZUlkKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYE5vIHByaWNlIElEIGZvdW5kIGZvciBzdWJzY3JpcHRpb246ICR7c3Vic2NyaXB0aW9uLmlkfWApO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcGxhblR5cGUgPSBnZXRQbGFuVHlwZUZyb21QcmljZUlkKHByaWNlSWQpO1xyXG4gICAgaWYgKCFwbGFuVHlwZSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBVbmtub3duIHByaWNlIElEOiAke3ByaWNlSWR9YCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBhd2FpdCBjcmVhdGVTdWJzY3JpcHRpb24oe1xyXG4gICAgICB1c2VyX2lkOiB1c2VyLmlkLFxyXG4gICAgICBzdHJpcGVfc3Vic2NyaXB0aW9uX2lkOiBzdWJzY3JpcHRpb24uaWQsXHJcbiAgICAgIHN0cmlwZV9wcmljZV9pZDogcHJpY2VJZCxcclxuICAgICAgc3RhdHVzOiBzdWJzY3JpcHRpb24uc3RhdHVzIGFzIGFueSxcclxuICAgICAgcGxhbl90eXBlOiBwbGFuVHlwZSxcclxuICAgICAgY3VycmVudF9wZXJpb2Rfc3RhcnQ6IG5ldyBEYXRlKHN1YnNjcmlwdGlvbi5jdXJyZW50X3BlcmlvZF9zdGFydCAqIDEwMDApLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIGN1cnJlbnRfcGVyaW9kX2VuZDogbmV3IERhdGUoc3Vic2NyaXB0aW9uLmN1cnJlbnRfcGVyaW9kX2VuZCAqIDEwMDApLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIGNhbmNlbF9hdF9wZXJpb2RfZW5kOiBzdWJzY3JpcHRpb24uY2FuY2VsX2F0X3BlcmlvZF9lbmQsXHJcbiAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgc3RyaXBlX3N1YnNjcmlwdGlvbl9pZDogc3Vic2NyaXB0aW9uLmlkXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKGBTdWJzY3JpcHRpb24gcmVjb3JkIGNyZWF0ZWQgZm9yIHVzZXI6ICR7dXNlci5lbWFpbH0sIHBsYW46ICR7cGxhblR5cGV9YCk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGhhbmRsaW5nIHN1YnNjcmlwdGlvbiBjcmVhdGVkOicsIGVycm9yKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlU3Vic2NyaXB0aW9uVXBkYXRlZChzdWJzY3JpcHRpb246IFN0cmlwZS5TdWJzY3JpcHRpb24pIHtcclxuICBjb25zb2xlLmxvZyhgU3Vic2NyaXB0aW9uIHVwZGF0ZWQ6ICR7c3Vic2NyaXB0aW9uLmlkfWApO1xyXG4gIFxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB1cGRhdGVEYXRhOiBQYXJ0aWFsPGltcG9ydCgnLi4vLi4vLi4vbGliL3N1cGFiYXNlJykuU3Vic2NyaXB0aW9uPiA9IHtcclxuICAgICAgc3RhdHVzOiBzdWJzY3JpcHRpb24uc3RhdHVzIGFzIGFueSxcclxuICAgICAgY3VycmVudF9wZXJpb2Rfc3RhcnQ6IG5ldyBEYXRlKHN1YnNjcmlwdGlvbi5jdXJyZW50X3BlcmlvZF9zdGFydCAqIDEwMDApLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIGN1cnJlbnRfcGVyaW9kX2VuZDogbmV3IERhdGUoc3Vic2NyaXB0aW9uLmN1cnJlbnRfcGVyaW9kX2VuZCAqIDEwMDApLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIGNhbmNlbF9hdF9wZXJpb2RfZW5kOiBzdWJzY3JpcHRpb24uY2FuY2VsX2F0X3BlcmlvZF9lbmQsXHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChzdWJzY3JpcHRpb24uY2FuY2VsZWRfYXQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5jYW5jZWxlZF9hdCA9IG5ldyBEYXRlKHN1YnNjcmlwdGlvbi5jYW5jZWxlZF9hdCAqIDEwMDApLnRvSVNPU3RyaW5nKCk7XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgdXBkYXRlU3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbi5pZCwgdXBkYXRlRGF0YSk7XHJcblxyXG4gICAgY29uc29sZS5sb2coYFN1YnNjcmlwdGlvbiB1cGRhdGVkIGluIGRhdGFiYXNlOiAke3N1YnNjcmlwdGlvbi5pZH1gKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaGFuZGxpbmcgc3Vic2NyaXB0aW9uIHVwZGF0ZWQ6JywgZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVTdWJzY3JpcHRpb25EZWxldGVkKHN1YnNjcmlwdGlvbjogU3RyaXBlLlN1YnNjcmlwdGlvbikge1xyXG4gIGNvbnNvbGUubG9nKGBTdWJzY3JpcHRpb24gZGVsZXRlZDogJHtzdWJzY3JpcHRpb24uaWR9YCk7XHJcbiAgXHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IHVwZGF0ZVN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb24uaWQsIHtcclxuICAgICAgc3RhdHVzOiAnY2FuY2VsZWQnLFxyXG4gICAgICBjYW5jZWxlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhgU3Vic2NyaXB0aW9uIG1hcmtlZCBhcyBjYW5jZWxlZCBpbiBkYXRhYmFzZTogJHtzdWJzY3JpcHRpb24uaWR9YCk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGhhbmRsaW5nIHN1YnNjcmlwdGlvbiBkZWxldGVkOicsIGVycm9yKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlUGF5bWVudFN1Y2NlZWRlZChpbnZvaWNlOiBTdHJpcGUuSW52b2ljZSkge1xyXG4gIGNvbnNvbGUubG9nKGBQYXltZW50IHN1Y2NlZWRlZDogJHtpbnZvaWNlLmlkfWApO1xyXG4gIFxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBjdXN0b21lcklkID0gaW52b2ljZS5jdXN0b21lciBhcyBzdHJpbmc7XHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgZ2V0VXNlckJ5U3RyaXBlQ3VzdG9tZXJJZChjdXN0b21lcklkKTtcclxuICAgIFxyXG4gICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFVzZXIgbm90IGZvdW5kIGZvciBjdXN0b21lcjogJHtjdXN0b21lcklkfWApO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGludm9pY2UucGF5bWVudF9pbnRlbnQpIHtcclxuICAgICAgYXdhaXQgY3JlYXRlUGF5bWVudCh7XHJcbiAgICAgICAgdXNlcl9pZDogdXNlci5pZCxcclxuICAgICAgICBzdHJpcGVfcGF5bWVudF9pbnRlbnRfaWQ6IGludm9pY2UucGF5bWVudF9pbnRlbnQgYXMgc3RyaW5nLFxyXG4gICAgICAgIGFtb3VudDogaW52b2ljZS5hbW91bnRfcGFpZCxcclxuICAgICAgICBjdXJyZW5jeTogaW52b2ljZS5jdXJyZW5jeSxcclxuICAgICAgICBzdGF0dXM6ICdzdWNjZWVkZWQnLFxyXG4gICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICBpbnZvaWNlX2lkOiBpbnZvaWNlLmlkLFxyXG4gICAgICAgICAgc3Vic2NyaXB0aW9uX2lkOiBpbnZvaWNlLnN1YnNjcmlwdGlvbiBhcyBzdHJpbmcgfHwgbnVsbFxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coYFBheW1lbnQgcmVjb3JkIGNyZWF0ZWQgZm9yIHVzZXI6ICR7dXNlci5lbWFpbH1gKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaGFuZGxpbmcgcGF5bWVudCBzdWNjZWVkZWQ6JywgZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVQYXltZW50RmFpbGVkKGludm9pY2U6IFN0cmlwZS5JbnZvaWNlKSB7XHJcbiAgY29uc29sZS5sb2coYFBheW1lbnQgZmFpbGVkOiAke2ludm9pY2UuaWR9YCk7XHJcbiAgXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGN1c3RvbWVySWQgPSBpbnZvaWNlLmN1c3RvbWVyIGFzIHN0cmluZztcclxuICAgIFxyXG4gICAgaWYgKCFjdXN0b21lcklkKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBObyBjdXN0b21lciBJRCBpbiBpbnZvaWNlICR7aW52b2ljZS5pZH0gLSBsaWtlbHkgYSB0ZXN0IGV2ZW50YCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IGdldFVzZXJCeVN0cmlwZUN1c3RvbWVySWQoY3VzdG9tZXJJZCk7XHJcbiAgICBcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICBjb25zb2xlLmxvZyhgVXNlciBub3QgZm91bmQgZm9yIGN1c3RvbWVyOiAke2N1c3RvbWVySWR9IC0gbWF5IGJlIGEgdGVzdCBjdXN0b21lcmApO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGludm9pY2UucGF5bWVudF9pbnRlbnQpIHtcclxuICAgICAgYXdhaXQgY3JlYXRlUGF5bWVudCh7XHJcbiAgICAgICAgdXNlcl9pZDogdXNlci5pZCxcclxuICAgICAgICBzdHJpcGVfcGF5bWVudF9pbnRlbnRfaWQ6IGludm9pY2UucGF5bWVudF9pbnRlbnQgYXMgc3RyaW5nLFxyXG4gICAgICAgIGFtb3VudDogaW52b2ljZS5hbW91bnRfZHVlLFxyXG4gICAgICAgIGN1cnJlbmN5OiBpbnZvaWNlLmN1cnJlbmN5LFxyXG4gICAgICAgIHN0YXR1czogJ2ZhaWxlZCcsXHJcbiAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgIGludm9pY2VfaWQ6IGludm9pY2UuaWQsXHJcbiAgICAgICAgICBzdWJzY3JpcHRpb25faWQ6IGludm9pY2Uuc3Vic2NyaXB0aW9uIGFzIHN0cmluZyB8fCBudWxsLFxyXG4gICAgICAgICAgZmFpbHVyZV9yZWFzb246ICdQYXltZW50IGZhaWxlZCdcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKGBGYWlsZWQgcGF5bWVudCByZWNvcmQgY3JlYXRlZCBmb3IgdXNlcjogJHt1c2VyLmVtYWlsfWApO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBoYW5kbGluZyBwYXltZW50IGZhaWxlZDonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVBheW1lbnRJbnRlbnRTdWNjZWVkZWQocGF5bWVudEludGVudDogU3RyaXBlLlBheW1lbnRJbnRlbnQpIHtcclxuICBjb25zb2xlLmxvZyhgUGF5bWVudCBpbnRlbnQgc3VjY2VlZGVkOiAke3BheW1lbnRJbnRlbnQuaWR9YCk7XHJcbiAgXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGN1c3RvbWVySWQgPSBwYXltZW50SW50ZW50LmN1c3RvbWVyIGFzIHN0cmluZztcclxuICAgIGlmICghY3VzdG9tZXJJZCkgcmV0dXJuO1xyXG4gICAgXHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgZ2V0VXNlckJ5U3RyaXBlQ3VzdG9tZXJJZChjdXN0b21lcklkKTtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBVc2VyIG5vdCBmb3VuZCBmb3IgY3VzdG9tZXI6ICR7Y3VzdG9tZXJJZH1gKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGF3YWl0IGNyZWF0ZVBheW1lbnQoe1xyXG4gICAgICB1c2VyX2lkOiB1c2VyLmlkLFxyXG4gICAgICBzdHJpcGVfcGF5bWVudF9pbnRlbnRfaWQ6IHBheW1lbnRJbnRlbnQuaWQsXHJcbiAgICAgIGFtb3VudDogcGF5bWVudEludGVudC5hbW91bnQsXHJcbiAgICAgIGN1cnJlbmN5OiBwYXltZW50SW50ZW50LmN1cnJlbmN5LFxyXG4gICAgICBzdGF0dXM6ICdzdWNjZWVkZWQnLFxyXG4gICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgIHBheW1lbnRfbWV0aG9kOiBwYXltZW50SW50ZW50LnBheW1lbnRfbWV0aG9kIGFzIHN0cmluZyB8fCBudWxsXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKGBQYXltZW50IGludGVudCByZWNvcmQgY3JlYXRlZCBmb3IgdXNlcjogJHt1c2VyLmVtYWlsfWApO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBoYW5kbGluZyBwYXltZW50IGludGVudCBzdWNjZWVkZWQ6JywgZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59Il0sIm5hbWVzIjpbImNvbnN0cnVjdFdlYmhvb2tFdmVudCIsImdldFBsYW5UeXBlRnJvbVByaWNlSWQiLCJjcmVhdGVTdWJzY3JpcHRpb24iLCJ1cGRhdGVTdWJzY3JpcHRpb24iLCJnZXRVc2VyQnlTdHJpcGVDdXN0b21lcklkIiwiY3JlYXRlUGF5bWVudCIsInJlY29yZFN0cmlwZUV2ZW50IiwibWFya0V2ZW50UHJvY2Vzc2VkIiwiaXNFdmVudFByb2Nlc3NlZCIsImNvbmZpZyIsImFwaSIsImJvZHlQYXJzZXIiLCJnZXRSYXdCb2R5IiwicmVxIiwiY2h1bmtzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJvbiIsImNodW5rIiwicHVzaCIsIkJ1ZmZlciIsImNvbmNhdCIsImVycm9yIiwiaGFuZGxlciIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJ3ZWJob29rU2VjcmV0IiwicHJvY2VzcyIsImVudiIsIlNUUklQRV9XRUJIT09LX1NFQ1JFVCIsImNvbnNvbGUiLCJyYXdCb2R5Iiwic2lnbmF0dXJlIiwiaGVhZGVycyIsImV2ZW50IiwibG9nIiwidHlwZSIsImlkIiwiaXNBbHJlYWR5UHJvY2Vzc2VkIiwicmVjZWl2ZWQiLCJza2lwcGVkIiwic2hvdWxkUHJvY2VzcyIsImRhdGEiLCJvYmplY3QiLCJhcGlfdmVyc2lvbiIsInVuZGVmaW5lZCIsImR1cGxpY2F0ZSIsInByb2Nlc3NlZCIsImhhbmRsZUNoZWNrb3V0U2Vzc2lvbkNvbXBsZXRlZCIsImhhbmRsZVN1YnNjcmlwdGlvbkNyZWF0ZWQiLCJoYW5kbGVTdWJzY3JpcHRpb25VcGRhdGVkIiwiaGFuZGxlU3Vic2NyaXB0aW9uRGVsZXRlZCIsImhhbmRsZVBheW1lbnRTdWNjZWVkZWQiLCJoYW5kbGVQYXltZW50RmFpbGVkIiwiaGFuZGxlUGF5bWVudEludGVudFN1Y2NlZWRlZCIsInNlc3Npb24iLCJjdXN0b21lcklkIiwiY3VzdG9tZXIiLCJ1c2VyIiwibW9kZSIsInN1YnNjcmlwdGlvbiIsImxpbmVJdGVtcyIsImxpbmVfaXRlbXMiLCJwcmljZSIsInBsYW5UeXBlIiwidXNlcl9pZCIsInN0cmlwZV9wcmljZV9pZCIsInBsYW5fdHlwZSIsImN1cnJlbnRfcGVyaW9kX3N0YXJ0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiY3VycmVudF9wZXJpb2RfZW5kIiwibm93IiwiY2FuY2VsX2F0X3BlcmlvZF9lbmQiLCJtZXRhZGF0YSIsInN0cmlwZV9jaGVja291dF9zZXNzaW9uX2lkIiwiZW1haWwiLCJwcmljZUlkIiwiaXRlbXMiLCJzdHJpcGVfc3Vic2NyaXB0aW9uX2lkIiwidXBkYXRlRGF0YSIsImNhbmNlbGVkX2F0IiwiaW52b2ljZSIsInBheW1lbnRfaW50ZW50Iiwic3RyaXBlX3BheW1lbnRfaW50ZW50X2lkIiwiYW1vdW50IiwiYW1vdW50X3BhaWQiLCJjdXJyZW5jeSIsImludm9pY2VfaWQiLCJzdWJzY3JpcHRpb25faWQiLCJhbW91bnRfZHVlIiwiZmFpbHVyZV9yZWFzb24iLCJwYXltZW50SW50ZW50IiwicGF5bWVudF9tZXRob2QiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/stripe/webhook.ts\n");

/***/ }),

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "stripe":
/*!*************************!*\
  !*** external "stripe" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("stripe");;

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fstripe%2Fwebhook&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cstripe%5Cwebhook.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();