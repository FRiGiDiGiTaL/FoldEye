"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/subscribe";
exports.ids = ["pages/api/subscribe"];
exports.modules = {

/***/ "(api-node)/./lib/supabase.ts":
/*!*************************!*\
  !*** ./lib/supabase.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createPayment: () => (/* binding */ createPayment),\n/* harmony export */   createSubscription: () => (/* binding */ createSubscription),\n/* harmony export */   getSubscriptionByStripeId: () => (/* binding */ getSubscriptionByStripeId),\n/* harmony export */   getUserByEmail: () => (/* binding */ getUserByEmail),\n/* harmony export */   getUserByStripeCustomerId: () => (/* binding */ getUserByStripeCustomerId),\n/* harmony export */   getUserSubscriptionStatus: () => (/* binding */ getUserSubscriptionStatus),\n/* harmony export */   isEventProcessed: () => (/* binding */ isEventProcessed),\n/* harmony export */   markEventProcessed: () => (/* binding */ markEventProcessed),\n/* harmony export */   recordStripeEvent: () => (/* binding */ recordStripeEvent),\n/* harmony export */   startTrial: () => (/* binding */ startTrial),\n/* harmony export */   supabase: () => (/* binding */ supabase),\n/* harmony export */   supabaseAdmin: () => (/* binding */ supabaseAdmin),\n/* harmony export */   updatePayment: () => (/* binding */ updatePayment),\n/* harmony export */   updateSubscription: () => (/* binding */ updateSubscription),\n/* harmony export */   upsertUser: () => (/* binding */ upsertUser)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__);\n// lib/supabase.ts\n\nconst supabaseUrl = \"https://mpcmqjxmnhlozrdmlkts.supabase.co\";\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1wY21xanhtbmhsb3pyZG1sa3RzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczNjk2ODEsImV4cCI6MjA3Mjk0NTY4MX0.Q3Pz8muPICb8Omrzaf247LAXP6Alx0WdbEb_0DwE9Nk\";\n// Client for server-side operations (admin)\nconst supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceKey, {\n    auth: {\n        autoRefreshToken: false,\n        persistSession: false\n    }\n});\n// Client for client-side operations\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\n// Stripe Events / Idempotency Functions\nasync function recordStripeEvent(stripeEventId, eventType, data, apiVersion) {\n    try {\n        console.log(`Recording Stripe event: ${stripeEventId} (${eventType})`);\n        const { data: result, error } = await supabaseAdmin.from('stripe_events').insert({\n            stripe_event_id: stripeEventId,\n            event_type: eventType,\n            data,\n            api_version: apiVersion,\n            processed: false\n        }).select().single();\n        if (error) {\n            // If it's a unique constraint violation, the event already exists\n            if (error.code === '23505') {\n                console.log(`Stripe event ${stripeEventId} already recorded`);\n                return false; // Event already exists\n            }\n            console.error('Error recording Stripe event:', error);\n            return false;\n        }\n        console.log(`Successfully recorded event: ${stripeEventId}`);\n        return true; // New event, proceed with processing\n    } catch (error) {\n        console.error('Error recording Stripe event:', error);\n        return false;\n    }\n}\nasync function markEventProcessed(stripeEventId) {\n    try {\n        console.log(`Marking event as processed: ${stripeEventId}`);\n        const { error } = await supabaseAdmin.from('stripe_events').update({\n            processed: true,\n            processed_at: new Date().toISOString()\n        }).eq('stripe_event_id', stripeEventId);\n        if (error) {\n            console.error('Error marking event as processed:', error);\n            return false;\n        }\n        console.log(`Successfully marked event as processed: ${stripeEventId}`);\n        return true;\n    } catch (error) {\n        console.error('Error marking event as processed:', error);\n        return false;\n    }\n}\nasync function isEventProcessed(stripeEventId) {\n    try {\n        console.log(`Checking if event is processed: ${stripeEventId}`);\n        const { data, error } = await supabaseAdmin.from('stripe_events').select('processed').eq('stripe_event_id', stripeEventId).single();\n        if (error) {\n            // If event not found, it hasn't been processed\n            if (error.code === 'PGRST116') {\n                console.log(`Event ${stripeEventId} not found in database`);\n                return false;\n            }\n            console.error('Error checking if event is processed:', error);\n            return false;\n        }\n        const isProcessed = data?.processed === true;\n        console.log(`Event ${stripeEventId} processed status: ${isProcessed}`);\n        return isProcessed;\n    } catch (error) {\n        console.error('Error checking if event is processed:', error);\n        return false;\n    }\n}\n// User Management Functions\nasync function getUserSubscriptionStatus(email) {\n    try {\n        const { data, error } = await supabaseAdmin.rpc('get_user_subscription_status', {\n            user_email: email\n        });\n        if (error) {\n            console.error('Error getting user subscription status:', error);\n            return null;\n        }\n        return data?.[0] || null;\n    } catch (error) {\n        console.error('Error calling get_user_subscription_status:', error);\n        return null;\n    }\n}\nasync function upsertUser(email, stripeCustomerId) {\n    try {\n        const { data, error } = await supabaseAdmin.rpc('upsert_user', {\n            user_email: email,\n            stripe_customer_id: stripeCustomerId\n        });\n        if (error) {\n            console.error('Error upserting user:', error);\n            return null;\n        }\n        return data;\n    } catch (error) {\n        console.error('Error calling upsert_user:', error);\n        return null;\n    }\n}\nasync function startTrial(email) {\n    try {\n        const { data, error } = await supabaseAdmin.rpc('start_trial', {\n            user_email: email\n        });\n        if (error) {\n            console.error('Error starting trial:', error);\n            return false;\n        }\n        return data === true;\n    } catch (error) {\n        console.error('Error calling start_trial:', error);\n        return false;\n    }\n}\nasync function getUserByEmail(email) {\n    try {\n        const { data, error } = await supabaseAdmin.from('users').select('*').eq('email', email).single();\n        if (error) {\n            console.error('Error getting user by email:', error);\n            return null;\n        }\n        return data;\n    } catch (error) {\n        console.error('Error getting user by email:', error);\n        return null;\n    }\n}\nasync function getUserByStripeCustomerId(customerId) {\n    try {\n        const { data, error } = await supabaseAdmin.from('users').select('*').eq('stripe_customer_id', customerId).single();\n        if (error) {\n            console.error('Error getting user by stripe customer ID:', error);\n            return null;\n        }\n        return data;\n    } catch (error) {\n        console.error('Error getting user by stripe customer ID:', error);\n        return null;\n    }\n}\n// Subscription Management Functions\nasync function createSubscription(subscription) {\n    try {\n        console.log('Creating subscription:', subscription);\n        const { data, error } = await supabaseAdmin.from('subscriptions').insert(subscription).select().single();\n        if (error) {\n            console.error('Error creating subscription:', error);\n            return null;\n        }\n        console.log('Successfully created subscription:', data.id);\n        return data;\n    } catch (error) {\n        console.error('Error creating subscription:', error);\n        return null;\n    }\n}\nasync function updateSubscription(stripeSubscriptionId, updates) {\n    try {\n        console.log(`Updating subscription: ${stripeSubscriptionId}`, updates);\n        const { data, error } = await supabaseAdmin.from('subscriptions').update(updates).eq('stripe_subscription_id', stripeSubscriptionId).select().single();\n        if (error) {\n            console.error('Error updating subscription:', error);\n            return null;\n        }\n        console.log('Successfully updated subscription:', data.id);\n        return data;\n    } catch (error) {\n        console.error('Error updating subscription:', error);\n        return null;\n    }\n}\nasync function getSubscriptionByStripeId(stripeSubscriptionId) {\n    try {\n        const { data, error } = await supabaseAdmin.from('subscriptions').select('*').eq('stripe_subscription_id', stripeSubscriptionId).single();\n        if (error) {\n            console.error('Error getting subscription by Stripe ID:', error);\n            return null;\n        }\n        return data;\n    } catch (error) {\n        console.error('Error getting subscription by Stripe ID:', error);\n        return null;\n    }\n}\n// Payment Management Functions\nasync function createPayment(payment) {\n    try {\n        console.log('Creating payment record:', payment.stripe_payment_intent_id);\n        const { data, error } = await supabaseAdmin.from('payments').insert(payment).select().single();\n        if (error) {\n            console.error('Error creating payment record:', error);\n            return null;\n        }\n        console.log('Successfully created payment record:', data.id);\n        return data;\n    } catch (error) {\n        console.error('Error creating payment record:', error);\n        return null;\n    }\n}\nasync function updatePayment(paymentIntentId, updates) {\n    try {\n        const { data, error } = await supabaseAdmin.from('payments').update(updates).eq('stripe_payment_intent_id', paymentIntentId).select().single();\n        if (error) {\n            console.error('Error updating payment:', error);\n            return null;\n        }\n        return data;\n    } catch (error) {\n        console.error('Error updating payment:', error);\n        return null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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NENBO1lBQzFELE9BQU87UUFDVDtRQUVBLE9BQU9MO0lBQ1QsRUFBRSxPQUFPSyxPQUFPO1FBQ2RILFFBQVFHLEtBQUssQ0FBQyw0Q0FBNENBO1FBQzFELE9BQU87SUFDVDtBQUNGO0FBRUEsK0JBQStCO0FBQ3hCLGVBQWVvQyxjQUFjQyxPQUEyQztJQUM3RSxJQUFJO1FBQ0Z4QyxRQUFRQyxHQUFHLENBQUMsNEJBQTRCdUMsUUFBUUMsd0JBQXdCO1FBRXhFLE1BQU0sRUFBRTNDLElBQUksRUFBRUssS0FBSyxFQUFFLEdBQUcsTUFBTWIsY0FDM0JjLElBQUksQ0FBQyxZQUNMQyxNQUFNLENBQUNtQyxTQUNQOUIsTUFBTSxHQUNOQyxNQUFNO1FBRVQsSUFBSVIsT0FBTztZQUNUSCxRQUFRRyxLQUFLLENBQUMsa0NBQWtDQTtZQUNoRCxPQUFPO1FBQ1Q7UUFFQUgsUUFBUUMsR0FBRyxDQUFDLHdDQUF3Q0gsS0FBS29DLEVBQUU7UUFDM0QsT0FBT3BDO0lBQ1QsRUFBRSxPQUFPSyxPQUFPO1FBQ2RILFFBQVFHLEtBQUssQ0FBQyxrQ0FBa0NBO1FBQ2hELE9BQU87SUFDVDtBQUNGO0FBRU8sZUFBZXVDLGNBQ3BCQyxlQUF1QixFQUN2Qk4sT0FBeUI7SUFFekIsSUFBSTtRQUNGLE1BQU0sRUFBRXZDLElBQUksRUFBRUssS0FBSyxFQUFFLEdBQUcsTUFBTWIsY0FDM0JjLElBQUksQ0FBQyxZQUNMVSxNQUFNLENBQUN1QixTQUNQbkIsRUFBRSxDQUFDLDRCQUE0QnlCLGlCQUMvQmpDLE1BQU0sR0FDTkMsTUFBTTtRQUVULElBQUlSLE9BQU87WUFDVEgsUUFBUUcsS0FBSyxDQUFDLDJCQUEyQkE7WUFDekMsT0FBTztRQUNUO1FBRUEsT0FBT0w7SUFDVCxFQUFFLE9BQU9LLE9BQU87UUFDZEgsUUFBUUcsS0FBSyxDQUFDLDJCQUEyQkE7UUFDekMsT0FBTztJQUNUO0FBQ0YiLCJzb3VyY2VzIjpbIkM6XFxhci1ib29rLWZvbGRpbmctYXNzaXN0YW50XFxsaWJcXHN1cGFiYXNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGxpYi9zdXBhYmFzZS50c1xyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xyXG5cclxuY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhO1xyXG5jb25zdCBzdXBhYmFzZVNlcnZpY2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZITtcclxuY29uc3Qgc3VwYWJhc2VBbm9uS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkhO1xyXG5cclxuLy8gQ2xpZW50IGZvciBzZXJ2ZXItc2lkZSBvcGVyYXRpb25zIChhZG1pbilcclxuZXhwb3J0IGNvbnN0IHN1cGFiYXNlQWRtaW4gPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlU2VydmljZUtleSwge1xyXG4gIGF1dGg6IHtcclxuICAgIGF1dG9SZWZyZXNoVG9rZW46IGZhbHNlLFxyXG4gICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxyXG4gIH0sXHJcbn0pO1xyXG5cclxuLy8gQ2xpZW50IGZvciBjbGllbnQtc2lkZSBvcGVyYXRpb25zXHJcbmV4cG9ydCBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5KTtcclxuXHJcbi8vIFR5cGVzIGZvciBkYXRhYmFzZSB0YWJsZXNcclxuZXhwb3J0IGludGVyZmFjZSBVc2VyIHtcclxuICBpZDogc3RyaW5nO1xyXG4gIGVtYWlsOiBzdHJpbmc7XHJcbiAgY3JlYXRlZF9hdDogc3RyaW5nO1xyXG4gIHVwZGF0ZWRfYXQ6IHN0cmluZztcclxuICBzdHJpcGVfY3VzdG9tZXJfaWQ/OiBzdHJpbmc7XHJcbiAgdHJpYWxfc3RhcnRfZGF0ZT86IHN0cmluZztcclxuICB0cmlhbF9lbmRfZGF0ZT86IHN0cmluZztcclxuICB0cmlhbF91c2VkOiBib29sZWFuO1xyXG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBTdWJzY3JpcHRpb24ge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgdXNlcl9pZDogc3RyaW5nO1xyXG4gIHN0cmlwZV9zdWJzY3JpcHRpb25faWQ/OiBzdHJpbmc7XHJcbiAgc3RyaXBlX3ByaWNlX2lkOiBzdHJpbmc7XHJcbiAgc3RhdHVzOiAnaW5jb21wbGV0ZScgfCAnaW5jb21wbGV0ZV9leHBpcmVkJyB8ICd0cmlhbGluZycgfCAnYWN0aXZlJyB8ICdwYXN0X2R1ZScgfCAnY2FuY2VsZWQnIHwgJ3VucGFpZCc7XHJcbiAgcGxhbl90eXBlOiAnbW9udGhseScgfCAneWVhcmx5JyB8ICdsaWZldGltZSc7XHJcbiAgY3VycmVudF9wZXJpb2Rfc3RhcnQ/OiBzdHJpbmc7XHJcbiAgY3VycmVudF9wZXJpb2RfZW5kPzogc3RyaW5nO1xyXG4gIGNhbmNlbF9hdF9wZXJpb2RfZW5kOiBib29sZWFuO1xyXG4gIGNhbmNlbGVkX2F0Pzogc3RyaW5nO1xyXG4gIGNyZWF0ZWRfYXQ6IHN0cmluZztcclxuICB1cGRhdGVkX2F0OiBzdHJpbmc7XHJcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFBheW1lbnQge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgdXNlcl9pZDogc3RyaW5nO1xyXG4gIHN1YnNjcmlwdGlvbl9pZD86IHN0cmluZztcclxuICBzdHJpcGVfcGF5bWVudF9pbnRlbnRfaWQ/OiBzdHJpbmc7XHJcbiAgYW1vdW50OiBudW1iZXI7XHJcbiAgY3VycmVuY3k6IHN0cmluZztcclxuICBzdGF0dXM6IHN0cmluZztcclxuICBjcmVhdGVkX2F0OiBzdHJpbmc7XHJcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFN0cmlwZUV2ZW50IHtcclxuICBpZDogc3RyaW5nO1xyXG4gIHN0cmlwZV9ldmVudF9pZDogc3RyaW5nO1xyXG4gIGV2ZW50X3R5cGU6IHN0cmluZztcclxuICBwcm9jZXNzZWQ6IGJvb2xlYW47XHJcbiAgcHJvY2Vzc2VkX2F0Pzogc3RyaW5nO1xyXG4gIGNyZWF0ZWRfYXQ6IHN0cmluZztcclxuICBhcGlfdmVyc2lvbj86IHN0cmluZztcclxuICBkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcclxuICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVXNlclN1YnNjcmlwdGlvblN0YXR1cyB7XHJcbiAgaGFzX2FjdGl2ZV9zdWJzY3JpcHRpb246IGJvb2xlYW47XHJcbiAgc3Vic2NyaXB0aW9uX3N0YXR1czogc3RyaW5nO1xyXG4gIHBsYW5fdHlwZTogc3RyaW5nO1xyXG4gIHRyaWFsX2FjdGl2ZTogYm9vbGVhbjtcclxuICB0cmlhbF9kYXlzX3JlbWFpbmluZzogbnVtYmVyO1xyXG59XHJcblxyXG4vLyBTdHJpcGUgRXZlbnRzIC8gSWRlbXBvdGVuY3kgRnVuY3Rpb25zXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZWNvcmRTdHJpcGVFdmVudChcclxuICBzdHJpcGVFdmVudElkOiBzdHJpbmcsXHJcbiAgZXZlbnRUeXBlOiBzdHJpbmcsXHJcbiAgZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT4sXHJcbiAgYXBpVmVyc2lvbj86IHN0cmluZ1xyXG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICB0cnkge1xyXG4gICAgY29uc29sZS5sb2coYFJlY29yZGluZyBTdHJpcGUgZXZlbnQ6ICR7c3RyaXBlRXZlbnRJZH0gKCR7ZXZlbnRUeXBlfSlgKTtcclxuICAgIFxyXG4gICAgY29uc3QgeyBkYXRhOiByZXN1bHQsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzdHJpcGVfZXZlbnRzJylcclxuICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgc3RyaXBlX2V2ZW50X2lkOiBzdHJpcGVFdmVudElkLFxyXG4gICAgICAgIGV2ZW50X3R5cGU6IGV2ZW50VHlwZSxcclxuICAgICAgICBkYXRhLFxyXG4gICAgICAgIGFwaV92ZXJzaW9uOiBhcGlWZXJzaW9uLFxyXG4gICAgICAgIHByb2Nlc3NlZDogZmFsc2VcclxuICAgICAgfSlcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgLy8gSWYgaXQncyBhIHVuaXF1ZSBjb25zdHJhaW50IHZpb2xhdGlvbiwgdGhlIGV2ZW50IGFscmVhZHkgZXhpc3RzXHJcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSAnMjM1MDUnKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYFN0cmlwZSBldmVudCAke3N0cmlwZUV2ZW50SWR9IGFscmVhZHkgcmVjb3JkZWRgKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEV2ZW50IGFscmVhZHkgZXhpc3RzXHJcbiAgICAgIH1cclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcmVjb3JkaW5nIFN0cmlwZSBldmVudDonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZyhgU3VjY2Vzc2Z1bGx5IHJlY29yZGVkIGV2ZW50OiAke3N0cmlwZUV2ZW50SWR9YCk7XHJcbiAgICByZXR1cm4gdHJ1ZTsgLy8gTmV3IGV2ZW50LCBwcm9jZWVkIHdpdGggcHJvY2Vzc2luZ1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZWNvcmRpbmcgU3RyaXBlIGV2ZW50OicsIGVycm9yKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtYXJrRXZlbnRQcm9jZXNzZWQoc3RyaXBlRXZlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnNvbGUubG9nKGBNYXJraW5nIGV2ZW50IGFzIHByb2Nlc3NlZDogJHtzdHJpcGVFdmVudElkfWApO1xyXG4gICAgXHJcbiAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzdHJpcGVfZXZlbnRzJylcclxuICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgcHJvY2Vzc2VkOiB0cnVlLFxyXG4gICAgICAgIHByb2Nlc3NlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgIH0pXHJcbiAgICAgIC5lcSgnc3RyaXBlX2V2ZW50X2lkJywgc3RyaXBlRXZlbnRJZCk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIG1hcmtpbmcgZXZlbnQgYXMgcHJvY2Vzc2VkOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKGBTdWNjZXNzZnVsbHkgbWFya2VkIGV2ZW50IGFzIHByb2Nlc3NlZDogJHtzdHJpcGVFdmVudElkfWApO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIG1hcmtpbmcgZXZlbnQgYXMgcHJvY2Vzc2VkOicsIGVycm9yKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpc0V2ZW50UHJvY2Vzc2VkKHN0cmlwZUV2ZW50SWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zb2xlLmxvZyhgQ2hlY2tpbmcgaWYgZXZlbnQgaXMgcHJvY2Vzc2VkOiAke3N0cmlwZUV2ZW50SWR9YCk7XHJcbiAgICBcclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3N0cmlwZV9ldmVudHMnKVxyXG4gICAgICAuc2VsZWN0KCdwcm9jZXNzZWQnKVxyXG4gICAgICAuZXEoJ3N0cmlwZV9ldmVudF9pZCcsIHN0cmlwZUV2ZW50SWQpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgLy8gSWYgZXZlbnQgbm90IGZvdW5kLCBpdCBoYXNuJ3QgYmVlbiBwcm9jZXNzZWRcclxuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdQR1JTVDExNicpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgRXZlbnQgJHtzdHJpcGVFdmVudElkfSBub3QgZm91bmQgaW4gZGF0YWJhc2VgKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY2hlY2tpbmcgaWYgZXZlbnQgaXMgcHJvY2Vzc2VkOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGlzUHJvY2Vzc2VkID0gZGF0YT8ucHJvY2Vzc2VkID09PSB0cnVlO1xyXG4gICAgY29uc29sZS5sb2coYEV2ZW50ICR7c3RyaXBlRXZlbnRJZH0gcHJvY2Vzc2VkIHN0YXR1czogJHtpc1Byb2Nlc3NlZH1gKTtcclxuICAgIHJldHVybiBpc1Byb2Nlc3NlZDtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY2hlY2tpbmcgaWYgZXZlbnQgaXMgcHJvY2Vzc2VkOicsIGVycm9yKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbi8vIFVzZXIgTWFuYWdlbWVudCBGdW5jdGlvbnNcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFVzZXJTdWJzY3JpcHRpb25TdGF0dXMoZW1haWw6IHN0cmluZyk6IFByb21pc2U8VXNlclN1YnNjcmlwdGlvblN0YXR1cyB8IG51bGw+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pbi5ycGMoJ2dldF91c2VyX3N1YnNjcmlwdGlvbl9zdGF0dXMnLCB7XHJcbiAgICAgIHVzZXJfZW1haWw6IGVtYWlsXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyB1c2VyIHN1YnNjcmlwdGlvbiBzdGF0dXM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZGF0YT8uWzBdIHx8IG51bGw7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNhbGxpbmcgZ2V0X3VzZXJfc3Vic2NyaXB0aW9uX3N0YXR1czonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cHNlcnRVc2VyKGVtYWlsOiBzdHJpbmcsIHN0cmlwZUN1c3RvbWVySWQ/OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pbi5ycGMoJ3Vwc2VydF91c2VyJywge1xyXG4gICAgICB1c2VyX2VtYWlsOiBlbWFpbCxcclxuICAgICAgc3RyaXBlX2N1c3RvbWVyX2lkOiBzdHJpcGVDdXN0b21lcklkXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBzZXJ0aW5nIHVzZXI6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY2FsbGluZyB1cHNlcnRfdXNlcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdGFydFRyaWFsKGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pbi5ycGMoJ3N0YXJ0X3RyaWFsJywge1xyXG4gICAgICB1c2VyX2VtYWlsOiBlbWFpbFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHN0YXJ0aW5nIHRyaWFsOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBkYXRhID09PSB0cnVlO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjYWxsaW5nIHN0YXJ0X3RyaWFsOicsIGVycm9yKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVc2VyQnlFbWFpbChlbWFpbDogc3RyaW5nKTogUHJvbWlzZTxVc2VyIHwgbnVsbD4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd1c2VycycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyB1c2VyIGJ5IGVtYWlsOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgdXNlciBieSBlbWFpbDonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVc2VyQnlTdHJpcGVDdXN0b21lcklkKGN1c3RvbWVySWQ6IHN0cmluZyk6IFByb21pc2U8VXNlciB8IG51bGw+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgndXNlcnMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdzdHJpcGVfY3VzdG9tZXJfaWQnLCBjdXN0b21lcklkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgdXNlciBieSBzdHJpcGUgY3VzdG9tZXIgSUQ6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyB1c2VyIGJ5IHN0cmlwZSBjdXN0b21lciBJRDonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbi8vIFN1YnNjcmlwdGlvbiBNYW5hZ2VtZW50IEZ1bmN0aW9uc1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlU3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbjogT21pdDxTdWJzY3JpcHRpb24sICdpZCcgfCAnY3JlYXRlZF9hdCcgfCAndXBkYXRlZF9hdCc+KTogUHJvbWlzZTxTdWJzY3JpcHRpb24gfCBudWxsPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnNvbGUubG9nKCdDcmVhdGluZyBzdWJzY3JpcHRpb246Jywgc3Vic2NyaXB0aW9uKTtcclxuICAgIFxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnc3Vic2NyaXB0aW9ucycpXHJcbiAgICAgIC5pbnNlcnQoc3Vic2NyaXB0aW9uKVxyXG4gICAgICAuc2VsZWN0KClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBzdWJzY3JpcHRpb246JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZygnU3VjY2Vzc2Z1bGx5IGNyZWF0ZWQgc3Vic2NyaXB0aW9uOicsIGRhdGEuaWQpO1xyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHN1YnNjcmlwdGlvbjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVTdWJzY3JpcHRpb24oXHJcbiAgc3RyaXBlU3Vic2NyaXB0aW9uSWQ6IHN0cmluZywgXHJcbiAgdXBkYXRlczogUGFydGlhbDxTdWJzY3JpcHRpb24+XHJcbik6IFByb21pc2U8U3Vic2NyaXB0aW9uIHwgbnVsbD4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zb2xlLmxvZyhgVXBkYXRpbmcgc3Vic2NyaXB0aW9uOiAke3N0cmlwZVN1YnNjcmlwdGlvbklkfWAsIHVwZGF0ZXMpO1xyXG4gICAgXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzdWJzY3JpcHRpb25zJylcclxuICAgICAgLnVwZGF0ZSh1cGRhdGVzKVxyXG4gICAgICAuZXEoJ3N0cmlwZV9zdWJzY3JpcHRpb25faWQnLCBzdHJpcGVTdWJzY3JpcHRpb25JZClcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgc3Vic2NyaXB0aW9uOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coJ1N1Y2Nlc3NmdWxseSB1cGRhdGVkIHN1YnNjcmlwdGlvbjonLCBkYXRhLmlkKTtcclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBzdWJzY3JpcHRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U3Vic2NyaXB0aW9uQnlTdHJpcGVJZChzdHJpcGVTdWJzY3JpcHRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxTdWJzY3JpcHRpb24gfCBudWxsPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3N1YnNjcmlwdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdzdHJpcGVfc3Vic2NyaXB0aW9uX2lkJywgc3RyaXBlU3Vic2NyaXB0aW9uSWQpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyBzdWJzY3JpcHRpb24gYnkgU3RyaXBlIElEOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgc3Vic2NyaXB0aW9uIGJ5IFN0cmlwZSBJRDonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbi8vIFBheW1lbnQgTWFuYWdlbWVudCBGdW5jdGlvbnNcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVBheW1lbnQocGF5bWVudDogT21pdDxQYXltZW50LCAnaWQnIHwgJ2NyZWF0ZWRfYXQnPik6IFByb21pc2U8UGF5bWVudCB8IG51bGw+IHtcclxuICB0cnkge1xyXG4gICAgY29uc29sZS5sb2coJ0NyZWF0aW5nIHBheW1lbnQgcmVjb3JkOicsIHBheW1lbnQuc3RyaXBlX3BheW1lbnRfaW50ZW50X2lkKTtcclxuICAgIFxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgncGF5bWVudHMnKVxyXG4gICAgICAuaW5zZXJ0KHBheW1lbnQpXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHBheW1lbnQgcmVjb3JkOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coJ1N1Y2Nlc3NmdWxseSBjcmVhdGVkIHBheW1lbnQgcmVjb3JkOicsIGRhdGEuaWQpO1xyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHBheW1lbnQgcmVjb3JkOicsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVBheW1lbnQoXHJcbiAgcGF5bWVudEludGVudElkOiBzdHJpbmcsXHJcbiAgdXBkYXRlczogUGFydGlhbDxQYXltZW50PlxyXG4pOiBQcm9taXNlPFBheW1lbnQgfCBudWxsPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3BheW1lbnRzJylcclxuICAgICAgLnVwZGF0ZSh1cGRhdGVzKVxyXG4gICAgICAuZXEoJ3N0cmlwZV9wYXltZW50X2ludGVudF9pZCcsIHBheW1lbnRJbnRlbnRJZClcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcGF5bWVudDonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBwYXltZW50OicsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufSJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdXBhYmFzZVNlcnZpY2VLZXkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwic3VwYWJhc2VBbm9uS2V5IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJzdXBhYmFzZUFkbWluIiwiYXV0aCIsImF1dG9SZWZyZXNoVG9rZW4iLCJwZXJzaXN0U2Vzc2lvbiIsInN1cGFiYXNlIiwicmVjb3JkU3RyaXBlRXZlbnQiLCJzdHJpcGVFdmVudElkIiwiZXZlbnRUeXBlIiwiZGF0YSIsImFwaVZlcnNpb24iLCJjb25zb2xlIiwibG9nIiwicmVzdWx0IiwiZXJyb3IiLCJmcm9tIiwiaW5zZXJ0Iiwic3RyaXBlX2V2ZW50X2lkIiwiZXZlbnRfdHlwZSIsImFwaV92ZXJzaW9uIiwicHJvY2Vzc2VkIiwic2VsZWN0Iiwic2luZ2xlIiwiY29kZSIsIm1hcmtFdmVudFByb2Nlc3NlZCIsInVwZGF0ZSIsInByb2Nlc3NlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImVxIiwiaXNFdmVudFByb2Nlc3NlZCIsImlzUHJvY2Vzc2VkIiwiZ2V0VXNlclN1YnNjcmlwdGlvblN0YXR1cyIsImVtYWlsIiwicnBjIiwidXNlcl9lbWFpbCIsInVwc2VydFVzZXIiLCJzdHJpcGVDdXN0b21lcklkIiwic3RyaXBlX2N1c3RvbWVyX2lkIiwic3RhcnRUcmlhbCIsImdldFVzZXJCeUVtYWlsIiwiZ2V0VXNlckJ5U3RyaXBlQ3VzdG9tZXJJZCIsImN1c3RvbWVySWQiLCJjcmVhdGVTdWJzY3JpcHRpb24iLCJzdWJzY3JpcHRpb24iLCJpZCIsInVwZGF0ZVN1YnNjcmlwdGlvbiIsInN0cmlwZVN1YnNjcmlwdGlvbklkIiwidXBkYXRlcyIsImdldFN1YnNjcmlwdGlvbkJ5U3RyaXBlSWQiLCJjcmVhdGVQYXltZW50IiwicGF5bWVudCIsInN0cmlwZV9wYXltZW50X2ludGVudF9pZCIsInVwZGF0ZVBheW1lbnQiLCJwYXltZW50SW50ZW50SWQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/supabase.ts\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsubscribe&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Csubscribe.ts&middlewareConfigBase64=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsubscribe&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Csubscribe.ts&middlewareConfigBase64=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   handler: () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/api-utils */ \"(api-node)/./node_modules/next/dist/server/api-utils/index.js\");\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_subscribe_ts__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./pages\\api\\subscribe.ts */ \"(api-node)/./pages/api/subscribe.ts\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(api-node)/./node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(api-node)/./node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__);\n\n\n\n\n// Import the userland code.\n\n\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_pages_api_subscribe_ts__WEBPACK_IMPORTED_MODULE_4__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_pages_api_subscribe_ts__WEBPACK_IMPORTED_MODULE_4__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/subscribe\",\n        pathname: \"/api/subscribe\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_subscribe_ts__WEBPACK_IMPORTED_MODULE_4__,\n    distDir: \".next\" || 0,\n    relativeProjectDir:  false || ''\n});\nasync function handler(req, res, ctx) {\n    let srcPage = \"/api/subscribe\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {}\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return;\n    }\n    const { query, params, prerenderManifest, routerServerContext } = prepareResult;\n    try {\n        const method = req.method || 'GET';\n        const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.getTracer)();\n        const activeSpan = tracer.getActiveScopeSpan();\n        const onRequestError = routeModule.instrumentationOnRequestError.bind(routeModule);\n        const invokeRouteModule = async (span)=>routeModule.render(req, res, {\n                query: {\n                    ...query,\n                    ...params\n                },\n                params,\n                allowedRevalidateHeaderKeys: [],\n                multiZoneDraftMode: Boolean(false),\n                trustHostHeader: false,\n                // TODO: get this from from runtime env so manifest\n                // doesn't need to load\n                previewProps: prerenderManifest.preview,\n                propagateError: false,\n                dev: routeModule.isDev,\n                page: \"/api/subscribe\",\n                internalRevalidate: routerServerContext == null ? void 0 : routerServerContext.revalidate,\n                onError: (...args)=>onRequestError(req, ...args)\n            }).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await invokeRouteModule(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, invokeRouteModule));\n        }\n    } catch (err) {\n        // we re-throw in dev to show the error overlay\n        if (routeModule.isDev) {\n            throw err;\n        }\n        // this is technically an invariant as error handling\n        // should be done inside of api-resolver onError\n        (0,next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__.sendError)(res, 500, 'Internal Server Error');\n    } finally{\n        // We don't allow any waitUntil work in pages API routes currently\n        // so if callback is present return with resolved promise since no\n        // pending work\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n    }\n}\n\n//# sourceMappingURL=pages-api.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGc3Vic2NyaWJlJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUNzdWJzY3JpYmUudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXVEO0FBQ0M7QUFDdUM7QUFDckM7QUFDMUQ7QUFDdUQ7QUFDaUI7QUFDRjtBQUN0RTtBQUNBLGlFQUFlLHdFQUFLLENBQUMsb0RBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLG9EQUFRO0FBQ3BDO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osYUFBYSxPQUFvQyxJQUFJLENBQUU7QUFDdkQsd0JBQXdCLE1BQXVDO0FBQy9ELENBQUM7QUFDTTtBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxLQUFxQixFQUFFLEVBRTFCO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHdEQUF3RDtBQUNwRTtBQUNBO0FBQ0EsdUJBQXVCLDRFQUFTO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLDZDQUE2QyxFQUE2QztBQUMxRiw0Q0FBNEMsS0FBd0M7QUFDcEYsaUNBQWlDLEtBQW9DO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlFQUFpRSxnRkFBYztBQUMvRSwrREFBK0QseUNBQXlDO0FBQ3hHO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLFFBQVEsRUFBRSxNQUFNO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0Esa0JBQWtCO0FBQ2xCLHVDQUF1QyxRQUFRLEVBQUUsUUFBUTtBQUN6RDtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDViw2RUFBNkUsZ0ZBQWM7QUFDM0YsaUNBQWlDLFFBQVEsRUFBRSxRQUFRO0FBQ25ELDBCQUEwQix1RUFBUTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLHFFQUFTO0FBQ2pCLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzZW5kRXJyb3IgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9hcGktdXRpbHNcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXHN1YnNjcmliZS50c1wiO1xuaW1wb3J0IHsgZ2V0VHJhY2VyLCBTcGFuS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi90cmFjZS90cmFjZXJcIjtcbmltcG9ydCB7IEJhc2VTZXJ2ZXJTcGFuIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3RyYWNlL2NvbnN0YW50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCAnZGVmYXVsdCcpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgJ2NvbmZpZycpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9zdWJzY3JpYmVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9zdWJzY3JpYmVcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiAnJyxcbiAgICAgICAgZmlsZW5hbWU6ICcnXG4gICAgfSxcbiAgICB1c2VybGFuZCxcbiAgICBkaXN0RGlyOiBwcm9jZXNzLmVudi5fX05FWFRfUkVMQVRJVkVfRElTVF9ESVIgfHwgJycsXG4gICAgcmVsYXRpdmVQcm9qZWN0RGlyOiBwcm9jZXNzLmVudi5fX05FWFRfUkVMQVRJVkVfUFJPSkVDVF9ESVIgfHwgJydcbn0pO1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxLCByZXMsIGN0eCkge1xuICAgIGxldCBzcmNQYWdlID0gXCIvYXBpL3N1YnNjcmliZVwiO1xuICAgIC8vIHR1cmJvcGFjayBkb2Vzbid0IG5vcm1hbGl6ZSBgL2luZGV4YCBpbiB0aGUgcGFnZSBuYW1lXG4gICAgLy8gc28gd2UgbmVlZCB0byB0byBwcm9jZXNzIGR5bmFtaWMgcm91dGVzIHByb3Blcmx5XG4gICAgLy8gVE9ETzogZml4IHR1cmJvcGFjayBwcm92aWRpbmcgZGlmZmVyaW5nIHZhbHVlIGZyb20gd2VicGFja1xuICAgIGlmIChwcm9jZXNzLmVudi5UVVJCT1BBQ0spIHtcbiAgICAgICAgc3JjUGFnZSA9IHNyY1BhZ2UucmVwbGFjZSgvXFwvaW5kZXgkLywgJycpIHx8ICcvJztcbiAgICB9XG4gICAgY29uc3QgcHJlcGFyZVJlc3VsdCA9IGF3YWl0IHJvdXRlTW9kdWxlLnByZXBhcmUocmVxLCByZXMsIHtcbiAgICAgICAgc3JjUGFnZVxuICAgIH0pO1xuICAgIGlmICghcHJlcGFyZVJlc3VsdCkge1xuICAgICAgICByZXMuc3RhdHVzQ29kZSA9IDQwMDtcbiAgICAgICAgcmVzLmVuZCgnQmFkIFJlcXVlc3QnKTtcbiAgICAgICAgY3R4LndhaXRVbnRpbCA9PSBudWxsID8gdm9pZCAwIDogY3R4LndhaXRVbnRpbC5jYWxsKGN0eCwgUHJvbWlzZS5yZXNvbHZlKCkpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHsgcXVlcnksIHBhcmFtcywgcHJlcmVuZGVyTWFuaWZlc3QsIHJvdXRlclNlcnZlckNvbnRleHQgfSA9IHByZXBhcmVSZXN1bHQ7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbWV0aG9kID0gcmVxLm1ldGhvZCB8fCAnR0VUJztcbiAgICAgICAgY29uc3QgdHJhY2VyID0gZ2V0VHJhY2VyKCk7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVNwYW4gPSB0cmFjZXIuZ2V0QWN0aXZlU2NvcGVTcGFuKCk7XG4gICAgICAgIGNvbnN0IG9uUmVxdWVzdEVycm9yID0gcm91dGVNb2R1bGUuaW5zdHJ1bWVudGF0aW9uT25SZXF1ZXN0RXJyb3IuYmluZChyb3V0ZU1vZHVsZSk7XG4gICAgICAgIGNvbnN0IGludm9rZVJvdXRlTW9kdWxlID0gYXN5bmMgKHNwYW4pPT5yb3V0ZU1vZHVsZS5yZW5kZXIocmVxLCByZXMsIHtcbiAgICAgICAgICAgICAgICBxdWVyeToge1xuICAgICAgICAgICAgICAgICAgICAuLi5xdWVyeSxcbiAgICAgICAgICAgICAgICAgICAgLi4ucGFyYW1zXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICAgICAgYWxsb3dlZFJldmFsaWRhdGVIZWFkZXJLZXlzOiBwcm9jZXNzLmVudi5fX05FWFRfQUxMT1dFRF9SRVZBTElEQVRFX0hFQURFUlMsXG4gICAgICAgICAgICAgICAgbXVsdGlab25lRHJhZnRNb2RlOiBCb29sZWFuKHByb2Nlc3MuZW52Ll9fTkVYVF9NVUxUSV9aT05FX0RSQUZUX01PREUpLFxuICAgICAgICAgICAgICAgIHRydXN0SG9zdEhlYWRlcjogcHJvY2Vzcy5lbnYuX19ORVhUX1RSVVNUX0hPU1RfSEVBREVSLFxuICAgICAgICAgICAgICAgIC8vIFRPRE86IGdldCB0aGlzIGZyb20gZnJvbSBydW50aW1lIGVudiBzbyBtYW5pZmVzdFxuICAgICAgICAgICAgICAgIC8vIGRvZXNuJ3QgbmVlZCB0byBsb2FkXG4gICAgICAgICAgICAgICAgcHJldmlld1Byb3BzOiBwcmVyZW5kZXJNYW5pZmVzdC5wcmV2aWV3LFxuICAgICAgICAgICAgICAgIHByb3BhZ2F0ZUVycm9yOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBkZXY6IHJvdXRlTW9kdWxlLmlzRGV2LFxuICAgICAgICAgICAgICAgIHBhZ2U6IFwiL2FwaS9zdWJzY3JpYmVcIixcbiAgICAgICAgICAgICAgICBpbnRlcm5hbFJldmFsaWRhdGU6IHJvdXRlclNlcnZlckNvbnRleHQgPT0gbnVsbCA/IHZvaWQgMCA6IHJvdXRlclNlcnZlckNvbnRleHQucmV2YWxpZGF0ZSxcbiAgICAgICAgICAgICAgICBvbkVycm9yOiAoLi4uYXJncyk9Pm9uUmVxdWVzdEVycm9yKHJlcSwgLi4uYXJncylcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoKCk9PntcbiAgICAgICAgICAgICAgICBpZiAoIXNwYW4pIHJldHVybjtcbiAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZXMoe1xuICAgICAgICAgICAgICAgICAgICAnaHR0cC5zdGF0dXNfY29kZSc6IHJlcy5zdGF0dXNDb2RlLFxuICAgICAgICAgICAgICAgICAgICAnbmV4dC5yc2MnOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvb3RTcGFuQXR0cmlidXRlcyA9IHRyYWNlci5nZXRSb290U3BhbkF0dHJpYnV0ZXMoKTtcbiAgICAgICAgICAgICAgICAvLyBXZSB3ZXJlIHVuYWJsZSB0byBnZXQgYXR0cmlidXRlcywgcHJvYmFibHkgT1RFTCBpcyBub3QgZW5hYmxlZFxuICAgICAgICAgICAgICAgIGlmICghcm9vdFNwYW5BdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQuc3Bhbl90eXBlJykgIT09IEJhc2VTZXJ2ZXJTcGFuLmhhbmRsZVJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBVbmV4cGVjdGVkIHJvb3Qgc3BhbiB0eXBlICcke3Jvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQuc3Bhbl90eXBlJyl9Jy4gUGxlYXNlIHJlcG9ydCB0aGlzIE5leHQuanMgaXNzdWUgaHR0cHM6Ly9naXRodWIuY29tL3ZlcmNlbC9uZXh0LmpzYCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3Qgcm91dGUgPSByb290U3BhbkF0dHJpYnV0ZXMuZ2V0KCduZXh0LnJvdXRlJyk7XG4gICAgICAgICAgICAgICAgaWYgKHJvdXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBgJHttZXRob2R9ICR7cm91dGV9YDtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGVzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICduZXh0LnJvdXRlJzogcm91dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnaHR0cC5yb3V0ZSc6IHJvdXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ25leHQuc3Bhbl9uYW1lJzogbmFtZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi51cGRhdGVOYW1lKG5hbWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNwYW4udXBkYXRlTmFtZShgJHttZXRob2R9ICR7cmVxLnVybH1gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgLy8gVE9ETzogYWN0aXZlU3BhbiBjb2RlIHBhdGggaXMgZm9yIHdoZW4gd3JhcHBlZCBieVxuICAgICAgICAvLyBuZXh0LXNlcnZlciBjYW4gYmUgcmVtb3ZlZCB3aGVuIHRoaXMgaXMgbm8gbG9uZ2VyIHVzZWRcbiAgICAgICAgaWYgKGFjdGl2ZVNwYW4pIHtcbiAgICAgICAgICAgIGF3YWl0IGludm9rZVJvdXRlTW9kdWxlKGFjdGl2ZVNwYW4pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXdhaXQgdHJhY2VyLndpdGhQcm9wYWdhdGVkQ29udGV4dChyZXEuaGVhZGVycywgKCk9PnRyYWNlci50cmFjZShCYXNlU2VydmVyU3Bhbi5oYW5kbGVSZXF1ZXN0LCB7XG4gICAgICAgICAgICAgICAgICAgIHNwYW5OYW1lOiBgJHttZXRob2R9ICR7cmVxLnVybH1gLFxuICAgICAgICAgICAgICAgICAgICBraW5kOiBTcGFuS2luZC5TRVJWRVIsXG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLm1ldGhvZCc6IG1ldGhvZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLnRhcmdldCc6IHJlcS51cmxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIGludm9rZVJvdXRlTW9kdWxlKSk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgLy8gd2UgcmUtdGhyb3cgaW4gZGV2IHRvIHNob3cgdGhlIGVycm9yIG92ZXJsYXlcbiAgICAgICAgaWYgKHJvdXRlTW9kdWxlLmlzRGV2KSB7XG4gICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdGhpcyBpcyB0ZWNobmljYWxseSBhbiBpbnZhcmlhbnQgYXMgZXJyb3IgaGFuZGxpbmdcbiAgICAgICAgLy8gc2hvdWxkIGJlIGRvbmUgaW5zaWRlIG9mIGFwaS1yZXNvbHZlciBvbkVycm9yXG4gICAgICAgIHNlbmRFcnJvcihyZXMsIDUwMCwgJ0ludGVybmFsIFNlcnZlciBFcnJvcicpO1xuICAgIH0gZmluYWxseXtcbiAgICAgICAgLy8gV2UgZG9uJ3QgYWxsb3cgYW55IHdhaXRVbnRpbCB3b3JrIGluIHBhZ2VzIEFQSSByb3V0ZXMgY3VycmVudGx5XG4gICAgICAgIC8vIHNvIGlmIGNhbGxiYWNrIGlzIHByZXNlbnQgcmV0dXJuIHdpdGggcmVzb2x2ZWQgcHJvbWlzZSBzaW5jZSBub1xuICAgICAgICAvLyBwZW5kaW5nIHdvcmtcbiAgICAgICAgY3R4LndhaXRVbnRpbCA9PSBudWxsID8gdm9pZCAwIDogY3R4LndhaXRVbnRpbC5jYWxsKGN0eCwgUHJvbWlzZS5yZXNvbHZlKCkpO1xuICAgIH1cbn1cblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcFxuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsubscribe&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Csubscribe.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/subscribe.ts":
/*!********************************!*\
  !*** ./pages/api/subscribe.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/supabase */ \"(api-node)/./lib/supabase.ts\");\n// pages/api/subscribe.ts\n\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            success: false,\n            error: \"Method not allowed\"\n        });\n    }\n    try {\n        const { email } = req.body;\n        // Validate email\n        if (!email || typeof email !== \"string\") {\n            return res.status(400).json({\n                success: false,\n                error: \"Email is required\"\n            });\n        }\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        if (!emailRegex.test(email.trim())) {\n            return res.status(400).json({\n                success: false,\n                error: \"Invalid email address\"\n            });\n        }\n        const cleanEmail = email.trim().toLowerCase();\n        // Check if user already exists and trial status\n        const subscriptionStatus = await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_0__.getUserSubscriptionStatus)(cleanEmail);\n        if (subscriptionStatus) {\n            // User exists, check if they already have active subscription or trial\n            if (subscriptionStatus.has_active_subscription) {\n                return res.status(400).json({\n                    success: false,\n                    error: \"You already have an active subscription\"\n                });\n            }\n            if (subscriptionStatus.trial_active) {\n                return res.status(400).json({\n                    success: false,\n                    error: \"You already have an active trial\"\n                });\n            }\n            // Check if trial was already used\n            if (subscriptionStatus.trial_days_remaining === 0 && !subscriptionStatus.trial_active) {\n                return res.status(400).json({\n                    success: false,\n                    error: \"Trial already used for this email address\"\n                });\n            }\n        }\n        // Create or update user in database\n        const userId = await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_0__.upsertUser)(cleanEmail);\n        if (!userId) {\n            return res.status(500).json({\n                success: false,\n                error: \"Failed to create user account\"\n            });\n        }\n        // Start trial\n        const trialStarted = await (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_0__.startTrial)(cleanEmail);\n        if (!trialStarted) {\n            return res.status(500).json({\n                success: false,\n                error: \"Failed to start trial. Trial may have already been used.\"\n            });\n        }\n        // Calculate trial dates\n        const startDate = Date.now();\n        const expiryDate = startDate + 7 * 24 * 60 * 60 * 1000; // 7 days\n        const trialData = {\n            email: cleanEmail,\n            startDate,\n            expiryDate,\n            trialDays: 7,\n            status: 'active'\n        };\n        console.log(`Trial started successfully for ${cleanEmail}`);\n        return res.status(200).json({\n            success: true,\n            message: \"Trial started successfully\",\n            trialData\n        });\n    } catch (error) {\n        console.error(\"Trial signup error:\", error);\n        return res.status(500).json({\n            success: false,\n            error: \"Internal server error. Please try again later.\"\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RiIsInNvdXJjZXMiOlsiQzpcXGFyLWJvb2stZm9sZGluZy1hc3Npc3RhbnRcXHBhZ2VzXFxhcGlcXHN1YnNjcmliZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwYWdlcy9hcGkvc3Vic2NyaWJlLnRzXHJcbmltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gXCJuZXh0XCI7XHJcbmltcG9ydCB7IHVwc2VydFVzZXIsIHN0YXJ0VHJpYWwsIGdldFVzZXJTdWJzY3JpcHRpb25TdGF0dXMgfSBmcm9tIFwiLi4vLi4vbGliL3N1cGFiYXNlXCI7XHJcblxyXG5pbnRlcmZhY2UgU3Vic2NyaWJlUmVxdWVzdCB7XHJcbiAgZW1haWw6IHN0cmluZztcclxufVxyXG5cclxuaW50ZXJmYWNlIFN1YnNjcmliZVJlc3BvbnNlIHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIG1lc3NhZ2U/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbiAgdHJpYWxEYXRhPzoge1xyXG4gICAgZW1haWw6IHN0cmluZztcclxuICAgIHN0YXJ0RGF0ZTogbnVtYmVyO1xyXG4gICAgZXhwaXJ5RGF0ZTogbnVtYmVyO1xyXG4gICAgdHJpYWxEYXlzOiBudW1iZXI7XHJcbiAgICBzdGF0dXM6IHN0cmluZztcclxuICB9O1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKFxyXG4gIHJlcTogTmV4dEFwaVJlcXVlc3QsXHJcbiAgcmVzOiBOZXh0QXBpUmVzcG9uc2U8U3Vic2NyaWJlUmVzcG9uc2U+XHJcbikge1xyXG4gIGlmIChyZXEubWV0aG9kICE9PSBcIlBPU1RcIikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgXHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgZXJyb3I6IFwiTWV0aG9kIG5vdCBhbGxvd2VkXCIgXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGVtYWlsIH06IFN1YnNjcmliZVJlcXVlc3QgPSByZXEuYm9keTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBlbWFpbFxyXG4gICAgaWYgKCFlbWFpbCB8fCB0eXBlb2YgZW1haWwgIT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogXCJFbWFpbCBpcyByZXF1aXJlZFwiXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGVtYWlsUmVnZXggPSAvXlteXFxzQF0rQFteXFxzQF0rXFwuW15cXHNAXSskLztcclxuICAgIGlmICghZW1haWxSZWdleC50ZXN0KGVtYWlsLnRyaW0oKSkpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogXCJJbnZhbGlkIGVtYWlsIGFkZHJlc3NcIlxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjbGVhbkVtYWlsID0gZW1haWwudHJpbSgpLnRvTG93ZXJDYXNlKCk7XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBhbHJlYWR5IGV4aXN0cyBhbmQgdHJpYWwgc3RhdHVzXHJcbiAgICBjb25zdCBzdWJzY3JpcHRpb25TdGF0dXMgPSBhd2FpdCBnZXRVc2VyU3Vic2NyaXB0aW9uU3RhdHVzKGNsZWFuRW1haWwpO1xyXG4gICAgXHJcbiAgICBpZiAoc3Vic2NyaXB0aW9uU3RhdHVzKSB7XHJcbiAgICAgIC8vIFVzZXIgZXhpc3RzLCBjaGVjayBpZiB0aGV5IGFscmVhZHkgaGF2ZSBhY3RpdmUgc3Vic2NyaXB0aW9uIG9yIHRyaWFsXHJcbiAgICAgIGlmIChzdWJzY3JpcHRpb25TdGF0dXMuaGFzX2FjdGl2ZV9zdWJzY3JpcHRpb24pIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogXCJZb3UgYWxyZWFkeSBoYXZlIGFuIGFjdGl2ZSBzdWJzY3JpcHRpb25cIlxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBpZiAoc3Vic2NyaXB0aW9uU3RhdHVzLnRyaWFsX2FjdGl2ZSkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiBcIllvdSBhbHJlYWR5IGhhdmUgYW4gYWN0aXZlIHRyaWFsXCJcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gQ2hlY2sgaWYgdHJpYWwgd2FzIGFscmVhZHkgdXNlZFxyXG4gICAgICBpZiAoc3Vic2NyaXB0aW9uU3RhdHVzLnRyaWFsX2RheXNfcmVtYWluaW5nID09PSAwICYmICFzdWJzY3JpcHRpb25TdGF0dXMudHJpYWxfYWN0aXZlKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IFwiVHJpYWwgYWxyZWFkeSB1c2VkIGZvciB0aGlzIGVtYWlsIGFkZHJlc3NcIlxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXRlIG9yIHVwZGF0ZSB1c2VyIGluIGRhdGFiYXNlXHJcbiAgICBjb25zdCB1c2VySWQgPSBhd2FpdCB1cHNlcnRVc2VyKGNsZWFuRW1haWwpO1xyXG4gICAgaWYgKCF1c2VySWQpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogXCJGYWlsZWQgdG8gY3JlYXRlIHVzZXIgYWNjb3VudFwiXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFN0YXJ0IHRyaWFsXHJcbiAgICBjb25zdCB0cmlhbFN0YXJ0ZWQgPSBhd2FpdCBzdGFydFRyaWFsKGNsZWFuRW1haWwpO1xyXG4gICAgaWYgKCF0cmlhbFN0YXJ0ZWQpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogXCJGYWlsZWQgdG8gc3RhcnQgdHJpYWwuIFRyaWFsIG1heSBoYXZlIGFscmVhZHkgYmVlbiB1c2VkLlwiXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENhbGN1bGF0ZSB0cmlhbCBkYXRlc1xyXG4gICAgY29uc3Qgc3RhcnREYXRlID0gRGF0ZS5ub3coKTtcclxuICAgIGNvbnN0IGV4cGlyeURhdGUgPSBzdGFydERhdGUgKyAoNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApOyAvLyA3IGRheXNcclxuXHJcbiAgICBjb25zdCB0cmlhbERhdGEgPSB7XHJcbiAgICAgIGVtYWlsOiBjbGVhbkVtYWlsLFxyXG4gICAgICBzdGFydERhdGUsXHJcbiAgICAgIGV4cGlyeURhdGUsXHJcbiAgICAgIHRyaWFsRGF5czogNyxcclxuICAgICAgc3RhdHVzOiAnYWN0aXZlJ1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhgVHJpYWwgc3RhcnRlZCBzdWNjZXNzZnVsbHkgZm9yICR7Y2xlYW5FbWFpbH1gKTtcclxuXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBtZXNzYWdlOiBcIlRyaWFsIHN0YXJ0ZWQgc3VjY2Vzc2Z1bGx5XCIsXHJcbiAgICAgIHRyaWFsRGF0YVxyXG4gICAgfSk7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiVHJpYWwgc2lnbnVwIGVycm9yOlwiLCBlcnJvcik7XHJcbiAgICBcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogXCJJbnRlcm5hbCBzZXJ2ZXIgZXJyb3IuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuXCJcclxuICAgIH0pO1xyXG4gIH1cclxufSJdLCJuYW1lcyI6WyJ1cHNlcnRVc2VyIiwic3RhcnRUcmlhbCIsImdldFVzZXJTdWJzY3JpcHRpb25TdGF0dXMiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwibWV0aG9kIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJlcnJvciIsImVtYWlsIiwiYm9keSIsImVtYWlsUmVnZXgiLCJ0ZXN0IiwidHJpbSIsImNsZWFuRW1haWwiLCJ0b0xvd2VyQ2FzZSIsInN1YnNjcmlwdGlvblN0YXR1cyIsImhhc19hY3RpdmVfc3Vic2NyaXB0aW9uIiwidHJpYWxfYWN0aXZlIiwidHJpYWxfZGF5c19yZW1haW5pbmciLCJ1c2VySWQiLCJ0cmlhbFN0YXJ0ZWQiLCJzdGFydERhdGUiLCJEYXRlIiwibm93IiwiZXhwaXJ5RGF0ZSIsInRyaWFsRGF0YSIsInRyaWFsRGF5cyIsImNvbnNvbGUiLCJsb2ciLCJtZXNzYWdlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/subscribe.ts\n");

/***/ }),

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fsubscribe&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Csubscribe.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();